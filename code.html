<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title></title>
<style type="text/css">
/**
 * Prism.s theme ported from highlight.js's xcode style
 */
pre code {
  padding: 1em;
}
.token.comment {
  color: #007400;
}
.token.punctuation {
  color: #999;
}
.token.tag,
.token.selector {
  color: #aa0d91;
}
.token.boolean,
.token.number,
.token.constant,
.token.symbol {
  color: #1c00cf;
}
.token.property,
.token.attr-name,
.token.string,
.token.char,
.token.builtin {
  color: #c41a16;
}
.token.inserted {
  background-color: #ccffd8;
}
.token.deleted {
  background-color: #ffebe9;
}
.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
  color: #9a6e3a;
}
.token.atrule,
.token.attr-value,
.token.keyword {
  color: #836c28;
}
.token.function,
.token.class-name {
  color: #DD4A68;
}
.token.regex,
.token.important,
.token.variable {
  color: #5c2699;
}
.token.important,
.token.bold {
  font-weight: bold;
}
.token.italic {
  font-style: italic;
}
</style>
<style type="text/css">
body {
  font-family: sans-serif;
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 1.5;
  box-sizing: border-box;
}
body, .footnotes, code { font-size: .9em; }
li li { font-size: .95em; }
*, *:before, *:after {
  box-sizing: inherit;
}
pre, img { max-width: 100%; }
pre, pre:hover {
  white-space: pre-wrap;
  word-break: break-all;
}
pre code {
  display: block;
  overflow-x: auto;
}
code { font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace; }
:not(pre) > code, code[class] { background-color: #F8F8F8; }
code.language-undefined, pre > code:not([class]) {
  background-color: inherit;
  border: 1px solid #eee;
}
table {
  margin: auto;
  border-top: 1px solid #666;
}
table thead th { border-bottom: 1px solid #ddd; }
th, td { padding: 5px; }
thead, tfoot, tr:nth-child(even) { background: #eee; }
blockquote {
  color: #666;
  margin: 0;
  padding-left: 1em;
  border-left: 0.5em solid #eee;
}
hr, .footnotes::before { border: 1px dashed #ddd; }
.frontmatter { text-align: center; }
#TOC .numbered li { list-style: none; }
#TOC .numbered { padding-left: 0; }
#TOC .numbered ul { padding-left: 1em; }
table, .body h2 { border-bottom: 1px solid #666; }
.body .appendix, .appendix ~ h2 { border-bottom-style: dashed; }
.footnote-ref a::before { content: "["; }
.footnote-ref a::after { content: "]"; }
section.footnotes::before {
  content: "";
  display: block;
  max-width: 20em;
}

@media print {
  body {
    font-size: 12pt;
    max-width: 100%;
  }
  tr, img { page-break-inside: avoid; }
}
@media only screen and (min-width: 992px) {
  pre { white-space: pre; }
}
</style>
<script>
$(document).ready(function(){
    if (typeof $('[data-toggle="tooltip"]').tooltip === 'function') {
        $('[data-toggle="tooltip"]').tooltip();
    }
    if ($('[data-toggle="popover"]').popover === 'function') {
        $('[data-toggle="popover"]').popover();
    }
});
</script>
<link href="C:\Users\humphreys\AppData\Local\R\win-library\4.2\kableExtra\lightable-0.0.1\lightable.css" rel="stylesheet" />
</head>
<body>
<div class="frontmatter">
<div class="title"><h1></h1></div>
<div class="author"><h2></h2></div>
<div class="date"><h3></h3></div>
</div>
<div class="body">
<pre><code class="language-r"># R code for evaluated code chunks in CausalQueries.qmd
# &quot;Making, Updating, and Querying Causal Models using CausalQueries&quot;
# Till Tietz, Lily Medina, Georgiy Syunyaev, Macartan Humphreys
# Generated using: knitr::spin(&quot;code.R&quot;)
# 15 November 2023

## Set up
#####################################################################
</code></pre>
<pre><code class="language-r">data(&quot;lipids_data&quot;)

lipids_data
</code></pre>
<pre><code>##    event strategy count
## 1 Z0X0Y0      ZXY   158
## 2 Z1X0Y0      ZXY    52
## 3 Z0X1Y0      ZXY     0
## 4 Z1X1Y0      ZXY    23
## 5 Z0X0Y1      ZXY    14
## 6 Z1X0Y1      ZXY    12
## 7 Z0X1Y1      ZXY     0
## 8 Z1X1Y1      ZXY    78
</code></pre>
<pre><code class="language-r">lipids_model &lt;-  
  make_model(&quot;Z -&gt; X -&gt; Y; X &lt;-&gt; Y&quot;) |&gt;
  update_model(lipids_data, refresh = 0)
</code></pre>
<pre><code class="language-r">lipids_queries &lt;- 
  lipids_model  |&gt;
  query_model(query = &quot;Y[X=1] - Y[X=0]&quot;,
              given = c(&quot;All&quot;,  &quot;X==0 &amp; Y==0&quot;, &quot;X[Z=1] &gt; X[Z=0]&quot;),
              using = &quot;posteriors&quot;) 

lipids_queries
</code></pre>
<pre><code>## 
## Causal queries generated by query_model (all at population level)
## 
## |query           |given           |using      |  mean|    sd| cred.low| cred.high|
## |:---------------|:---------------|:----------|-----:|-----:|--------:|---------:|
## |Y[X=1] - Y[X=0] |-               |posteriors | 0.555| 0.099|    0.370|     0.730|
## |Y[X=1] - Y[X=0] |X==0 &amp; Y==0     |posteriors | 0.638| 0.153|    0.375|     0.894|
## |Y[X=1] - Y[X=0] |X[Z=1] &gt; X[Z=0] |posteriors | 0.703| 0.054|    0.591|     0.804|
</code></pre>
<pre><code class="language-r">lipids_queries |&gt;
  dplyr::select(query, given, mean, sd, starts_with(&quot;cred&quot;)) |&gt;
  knitr::kable(
    digits = 2,
    booktabs = TRUE,
    align = &quot;c&quot;,
    escape = TRUE, 
    linesep = &quot;&quot;) |&gt; 
  kableExtra::kable_classic_2(latex_options = c(&quot;scale_down&quot;))
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> query </th>
   <th style="text-align:center;"> given </th>
   <th style="text-align:center;"> mean </th>
   <th style="text-align:center;"> sd </th>
   <th style="text-align:center;"> cred.low </th>
   <th style="text-align:center;"> cred.high </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> 0.55 </td>
   <td style="text-align:center;"> 0.10 </td>
   <td style="text-align:center;"> 0.37 </td>
   <td style="text-align:center;"> 0.73 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> X==0 &amp; Y==0 </td>
   <td style="text-align:center;"> 0.64 </td>
   <td style="text-align:center;"> 0.15 </td>
   <td style="text-align:center;"> 0.37 </td>
   <td style="text-align:center;"> 0.89 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> X[Z=1] &gt; X[Z=0] </td>
   <td style="text-align:center;"> 0.70 </td>
   <td style="text-align:center;"> 0.05 </td>
   <td style="text-align:center;"> 0.59 </td>
   <td style="text-align:center;"> 0.80 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">with_pars &lt;- 
  lipids_model |&gt;
  set_parameters(param_type = &quot;prior_draw&quot;) 

with_pars$parameters_df |&gt;
  dplyr::select(node,  nodal_type, param_set, param_names, param_value, priors) |&gt; 
  knitr::kable(
    digits = 2,
    booktabs = TRUE,
    align = &quot;c&quot;,
    escape = TRUE,
    longtable = TRUE,
    linesep = &quot;&quot;) |&gt; 
  kableExtra::kable_classic_2(latex_options = c(&quot;hold_position&quot;))
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> node </th>
   <th style="text-align:center;"> nodal_type </th>
   <th style="text-align:center;"> param_set </th>
   <th style="text-align:center;"> param_names </th>
   <th style="text-align:center;"> param_value </th>
   <th style="text-align:center;"> priors </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> Z </td>
   <td style="text-align:center;"> 0 </td>
   <td style="text-align:center;"> Z </td>
   <td style="text-align:center;"> Z.0 </td>
   <td style="text-align:center;"> 0.57 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Z </td>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> Z </td>
   <td style="text-align:center;"> Z.1 </td>
   <td style="text-align:center;"> 0.43 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> X.00 </td>
   <td style="text-align:center;"> 0.24 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> X.10 </td>
   <td style="text-align:center;"> 0.30 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> X.01 </td>
   <td style="text-align:center;"> 0.20 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> X.11 </td>
   <td style="text-align:center;"> 0.27 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> Y.X.00 </td>
   <td style="text-align:center;"> Y.00_X.00 </td>
   <td style="text-align:center;"> 0.71 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> Y.X.00 </td>
   <td style="text-align:center;"> Y.10_X.00 </td>
   <td style="text-align:center;"> 0.19 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> Y.X.00 </td>
   <td style="text-align:center;"> Y.01_X.00 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> Y.X.00 </td>
   <td style="text-align:center;"> Y.11_X.00 </td>
   <td style="text-align:center;"> 0.10 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> Y.X.01 </td>
   <td style="text-align:center;"> Y.00_X.01 </td>
   <td style="text-align:center;"> 0.15 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> Y.X.01 </td>
   <td style="text-align:center;"> Y.10_X.01 </td>
   <td style="text-align:center;"> 0.40 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> Y.X.01 </td>
   <td style="text-align:center;"> Y.01_X.01 </td>
   <td style="text-align:center;"> 0.39 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> Y.X.01 </td>
   <td style="text-align:center;"> Y.11_X.01 </td>
   <td style="text-align:center;"> 0.06 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> Y.X.10 </td>
   <td style="text-align:center;"> Y.00_X.10 </td>
   <td style="text-align:center;"> 0.17 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> Y.X.10 </td>
   <td style="text-align:center;"> Y.10_X.10 </td>
   <td style="text-align:center;"> 0.65 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> Y.X.10 </td>
   <td style="text-align:center;"> Y.01_X.10 </td>
   <td style="text-align:center;"> 0.14 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> Y.X.10 </td>
   <td style="text-align:center;"> Y.11_X.10 </td>
   <td style="text-align:center;"> 0.04 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> Y.X.11 </td>
   <td style="text-align:center;"> Y.00_X.11 </td>
   <td style="text-align:center;"> 0.24 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> Y.X.11 </td>
   <td style="text-align:center;"> Y.10_X.11 </td>
   <td style="text-align:center;"> 0.71 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> Y.X.11 </td>
   <td style="text-align:center;"> Y.01_X.11 </td>
   <td style="text-align:center;"> 0.04 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> Y.X.11 </td>
   <td style="text-align:center;"> Y.11_X.11 </td>
   <td style="text-align:center;"> 0.01 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">model &lt;- make_model(&quot;X -&gt; M -&gt; Y &lt;- X&quot;)
</code></pre>
<pre><code class="language-r">lipids_model |&gt; plot()

lipids_model |&gt;
  plot(x_coord = 1:3,
       y_coord = c(3,2,1),
       textcol = &quot;white&quot;,
       textsize = 3,
       shape = 18,
       nodecol = &quot;grey&quot;,
       nodesize = 12)
</code></pre>
<p><img src="data:image/png;base64,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" alt="Examples of model graphs." /><img src="data:image/png;base64,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" alt="Examples of model graphs." /></p>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; 
  grab(&quot;parameters_df&quot;) 
</code></pre>
<pre><code>## Mapping of model parameters to nodal types: 
## 
## ----------------------------------------------------------------
## 
##  param_names: name of parameter
##  node: name of endogeneous node associated with the parameter
##  gen: partial causal ordering of the parameter's node
##  param_set: parameter groupings forming a simplex
##  given: if model has confounding gives conditioning nodal type
##  param_value: parameter values
##  priors: hyperparameters of the prior Dirichlet distribution 
## 
## ----------------------------------------------------------------
## 
##   param_names node gen param_set nodal_type given param_value priors
## 1         X.0    X   1         X          0              0.50      1
## 2         X.1    X   1         X          1              0.50      1
## 3        Y.00    Y   2         Y         00              0.25      1
## 4        Y.10    Y   2         Y         10              0.25      1
## 5        Y.01    Y   2         Y         01              0.25      1
## 6        Y.11    Y   2         Y         11              0.25      1
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y &lt;- M; W -&gt; Y&quot;) |&gt; 
  interpret_type(nodes = &quot;Y&quot;)
</code></pre>
<pre><code>## $Y
##   node position     display            interpretation
## 1    Y        1 Y[*]******* Y | M = 0 &amp; W = 0 &amp; X = 0
## 2    Y        2 Y*[*]****** Y | M = 1 &amp; W = 0 &amp; X = 0
## 3    Y        3 Y**[*]***** Y | M = 0 &amp; W = 1 &amp; X = 0
## 4    Y        4 Y***[*]**** Y | M = 1 &amp; W = 1 &amp; X = 0
## 5    Y        5 Y****[*]*** Y | M = 0 &amp; W = 0 &amp; X = 1
## 6    Y        6 Y*****[*]** Y | M = 1 &amp; W = 0 &amp; X = 1
## 7    Y        7 Y******[*]* Y | M = 0 &amp; W = 1 &amp; X = 1
## 8    Y        8 Y*******[*] Y | M = 1 &amp; W = 1 &amp; X = 1
</code></pre>
<pre><code class="language-r">lipids_model |&gt; 
  grab(&quot;causal_types&quot;)
</code></pre>
<pre><code>## 
## Causal Types: 
## cartesian product of nodal types
## 
## 
##  first 10 causal types: 
##            Z  X  Y
## Z0.X00.Y00 0 00 00
## Z1.X00.Y00 1 00 00
## Z0.X10.Y00 0 10 00
## Z1.X10.Y00 1 10 00
## Z0.X01.Y00 0 01 00
## Z1.X01.Y00 1 01 00
## Z0.X11.Y00 0 11 00
## Z1.X11.Y00 1 11 00
## Z0.X00.Y10 0 00 10
## Z1.X00.Y10 1 00 10
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; 
  grab(&quot;parameter_matrix&quot;)
</code></pre>
<pre><code>## 
## Rows are parameters, grouped in parameter sets
## 
## Columns are causal types
## 
## Cell entries indicate whether a parameter probability isused
## in the calculation of causal type probability
## 
##      X0.Y00 X1.Y00 X0.Y10 X1.Y10 X0.Y01 X1.Y01 X0.Y11 X1.Y11
## X.0       1      0      1      0      1      0      1      0
## X.1       0      1      0      1      0      1      0      1
## Y.00      1      1      0      0      0      0      0      0
## Y.10      0      0      1      1      0      0      0      0
## Y.01      0      0      0      0      1      1      0      0
## Y.11      0      0      0      0      0      0      1      1
## 
##  
##  param_set  (P)
## 
</code></pre>
<pre><code class="language-r">## make_model(&quot;X -&gt; Y&quot;) |&gt;
##   set_parameter_matrix()
## 
</code></pre>
<pre><code class="language-r">model_restricted &lt;- 
  lipids_model |&gt; 
  set_restrictions(&quot;X[Z=1] &lt; X[Z=0]&quot;)
</code></pre>
<pre><code class="language-r">## model &lt;- lipids_model |&gt;
##   set_restrictions(labels = list(X = &quot;01&quot;, Y = c(&quot;00&quot;, &quot;01&quot;, &quot;11&quot;)),
##                    keep = TRUE)
## 
</code></pre>
<pre><code class="language-r">## model &lt;- lipids_model |&gt;
##   set_restrictions(labels = list(Y = &quot;?0&quot;))
</code></pre>
<pre><code class="language-r">## model &lt;- lipids_model |&gt;
##   set_restrictions(labels = list(Y = c('00', '11')), given = 'X.00')
</code></pre>
<pre><code class="language-r">statements &lt;- list(&quot;X -&gt; Y &lt;- W&quot;, 
                   &quot;X -&gt; Y &lt;- W; X &lt;-&gt; W&quot;, 
                   &quot;X -&gt; Y &lt;- W; X &lt;-&gt; Y; W &lt;-&gt; Y&quot;,
                   &quot;X -&gt; Y &lt;- W; X &lt;-&gt; Y; W &lt;-&gt; Y; X &lt;-&gt; W&quot;, 
                   &quot;X -&gt; W -&gt; Y &lt;- X&quot;,
                   &quot;X -&gt; W -&gt; Y &lt;- X; W &lt;-&gt; Y&quot;,
                   &quot;X -&gt; W -&gt; Y &lt;- X; X &lt;-&gt; W; W &lt;-&gt; Y&quot;, 
                   &quot;X -&gt; W -&gt; Y &lt;- X; X &lt;-&gt; W; W &lt;-&gt; Y; X &lt;-&gt; Y&quot;)

dof &lt;- function(statement) {
  make_model(statement, add_causal_types = FALSE) |&gt;
  grab(&quot;parameters_df&quot;)  |&gt;
  group_by(param_set) |&gt;
  summarize(n  = n() - 1) |&gt;
  pull(n) |&gt;
  sum()
}
  

statements |&gt; 
  lapply(function(s) paste0(&quot;`&quot;, s, &quot;`&quot;)) |&gt; 
  unlist() |&gt; 
  data.frame(
    Model = _,
    dof = unlist(lapply(statements, dof))) |&gt;
  knitr::kable(
    digits = 2,
    booktabs = TRUE,
    align = c(&quot;l&quot;, &quot;c&quot;),
    escape = TRUE, 
    linesep = &quot;&quot;,
    col.names = c(&quot;Model&quot;, &quot;Degrees of freedom&quot;)) 
</code></pre>
<table>
<thead>
<tr>
<th align="left">Model</th>
<th align="center">Degrees of freedom</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>X -&gt; Y &lt;- W</code></td>
<td align="center">17</td>
</tr>
<tr>
<td align="left"><code>X -&gt; Y &lt;- W; X &lt;-&gt; W</code></td>
<td align="center">18</td>
</tr>
<tr>
<td align="left"><code>X -&gt; Y &lt;- W; X &lt;-&gt; Y; W &lt;-&gt; Y</code></td>
<td align="center">62</td>
</tr>
<tr>
<td align="left"><code>X -&gt; Y &lt;- W; X &lt;-&gt; Y; W &lt;-&gt; Y; X &lt;-&gt; W</code></td>
<td align="center">63</td>
</tr>
<tr>
<td align="left"><code>X -&gt; W -&gt; Y &lt;- X</code></td>
<td align="center">19</td>
</tr>
<tr>
<td align="left"><code>X -&gt; W -&gt; Y &lt;- X; W &lt;-&gt; Y</code></td>
<td align="center">64</td>
</tr>
<tr>
<td align="left"><code>X -&gt; W -&gt; Y &lt;- X; X &lt;-&gt; W; W &lt;-&gt; Y</code></td>
<td align="center">67</td>
</tr>
<tr>
<td align="left"><code>X -&gt; W -&gt; Y &lt;- X; X &lt;-&gt; W; W &lt;-&gt; Y; X &lt;-&gt; Y</code></td>
<td align="center">127</td>
</tr>
</tbody>
</table>
<pre><code class="language-r">lipids_model |&gt; grab(&quot;prior_hyperparameters&quot;, &quot;X&quot;) 
</code></pre>
<pre><code>##       Z.0       Z.1      X.00      X.10      X.01      X.11 Y.00_X.00 Y.10_X.00 Y.01_X.00 Y.11_X.00 
##         1         1         1         1         1         1         1         1         1         1 
## Y.00_X.01 Y.10_X.01 Y.01_X.01 Y.11_X.01 Y.00_X.10 Y.10_X.10 Y.01_X.10 Y.11_X.10 Y.00_X.11 Y.10_X.11 
##         1         1         1         1         1         1         1         1         1         1 
## Y.01_X.11 Y.11_X.11 
##         1         1
</code></pre>
<pre><code class="language-r">## model &lt;- lipids_model |&gt;
##   set_priors(distribution = &quot;jeffreys&quot;)
## 
</code></pre>
<pre><code class="language-r">lipids_model |&gt; 
  set_priors(node = &quot;X&quot;, alphas = 1:4) |&gt; 
  grab(&quot;prior_hyperparameters&quot;, &quot;X&quot;)
</code></pre>
<pre><code>## Warning in make_par_values(model = model, alter = &quot;priors&quot;, x = alphas, : A specified condition matches
## multiple parameters. In these cases it is unclear which parameter value should be assigned to which
## parameter. Assignment thus defaults to the order in which parameters appear in 'parameters_df'. We advise
## checking that parameter assignment was carried out as you intended.
</code></pre>
<pre><code>##       Z.0       Z.1      X.00      X.10      X.01      X.11 Y.00_X.00 Y.10_X.00 Y.01_X.00 Y.11_X.00 
##         1         1         1         2         3         4         1         1         1         1 
## Y.00_X.01 Y.10_X.01 Y.01_X.01 Y.11_X.01 Y.00_X.10 Y.10_X.10 Y.01_X.10 Y.11_X.10 Y.00_X.11 Y.10_X.11 
##         1         1         1         1         1         1         1         1         1         1 
## Y.01_X.11 Y.11_X.11 
##         1         1
</code></pre>
<pre><code class="language-r">lipids_model |&gt;
  set_priors(statement = &quot;X[Z=1] &gt; X[Z=0]&quot;, alphas = 3) |&gt;
  grab(&quot;prior_hyperparameters&quot;, &quot;X&quot;)
</code></pre>
<pre><code>##       Z.0       Z.1      X.00      X.10      X.01      X.11 Y.00_X.00 Y.10_X.00 Y.01_X.00 Y.11_X.00 
##         1         1         1         1         3         1         1         1         1         1 
## Y.00_X.01 Y.10_X.01 Y.01_X.01 Y.11_X.01 Y.00_X.10 Y.10_X.10 Y.01_X.10 Y.11_X.10 Y.00_X.11 Y.10_X.11 
##         1         1         1         1         1         1         1         1         1         1 
## Y.01_X.11 Y.11_X.11 
##         1         1
</code></pre>
<pre><code class="language-r">## make_model(&quot;X -&gt; Y&quot;) |&gt;
##   query_model(&quot;Y[X=1] &gt; Y[X=0]&quot;, using = &quot;priors&quot;)
## 
## make_model(&quot;X -&gt; M -&gt; Y&quot;) |&gt;
##   query_model(&quot;Y[X=1] &gt; Y[X=0]&quot;, using = &quot;priors&quot;)
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; 
  grab(&quot;prior_hyperparameters&quot;)
</code></pre>
<pre><code>##  X.0  X.1 Y.00 Y.10 Y.01 Y.11 
##    1    1    1    1    1    1
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt;
  set_parameters(statement = &quot;Y[X=1] &gt; Y[X=0]&quot;, parameters = .5) |&gt;
  grab(&quot;prior_hyperparameters&quot;)
</code></pre>
<pre><code>##  X.0  X.1 Y.00 Y.10 Y.01 Y.11 
##    1    1    1    1    1    1
</code></pre>
<pre><code class="language-r">sample_data_1 &lt;- 
  lipids_model |&gt; 
  make_data(n = 4)
</code></pre>
<pre><code class="language-r">lipids_model |&gt;
  make_data(n = 3, param_type = &quot;prior_draw&quot;)
</code></pre>
<pre><code>##   Z X Y
## 1 1 0 0
## 2 1 0 0
## 3 1 0 1
</code></pre>
<pre><code class="language-r">sample_data_2 &lt;-
  lipids_model |&gt;
  make_data(n = 8,
            nodes = list(c(&quot;Z&quot;, &quot;Y&quot;), &quot;X&quot;),
            probs = list(1, .5),
            subsets = list(TRUE, &quot;Z==1 &amp; Y==0&quot;),
            verbose = FALSE)

sample_data_2
</code></pre>
<pre><code>##   Z  X Y
## 1 0 NA 0
## 2 0 NA 0
## 3 0  1 0
## 4 0 NA 0
## 5 0 NA 1
## 6 1 NA 1
## 7 1 NA 0
## 8 1 NA 1
</code></pre>
<pre><code class="language-r">sample_data_2 |&gt; collapse_data(lipids_model)
</code></pre>
<pre><code>##     event strategy count
## 1  Z0X0Y0      ZXY     0
## 2  Z1X0Y0      ZXY     0
## 3  Z0X1Y0      ZXY     1
## 4  Z1X1Y0      ZXY     0
## 5  Z0X0Y1      ZXY     0
## 6  Z1X0Y1      ZXY     0
## 7  Z0X1Y1      ZXY     0
## 8  Z1X1Y1      ZXY     0
## 9    Z0Y0       ZY     3
## 10   Z1Y0       ZY     1
## 11   Z0Y1       ZY     1
## 12   Z1Y1       ZY     2
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; 
  grab(&quot;parameter_mapping&quot;) 
</code></pre>
<pre><code>##      X0Y0 X1Y0 X0Y1 X1Y1
## X.0     1    0    1    0
## X.1     0    1    0    1
## Y.00    1    1    0    0
## Y.10    0    1    1    0
## Y.01    1    0    0    1
## Y.11    0    0    1    1
## attr(,&quot;map&quot;)
##      X0Y0 X1Y0 X0Y1 X1Y1
## X0Y0    1    0    0    0
## X1Y0    0    1    0    0
## X0Y1    0    0    1    0
## X1Y1    0    0    0    1
</code></pre>
<pre><code class="language-r">## model &lt;- update_model(model, data)
</code></pre>
<pre><code class="language-r">list(uncensored = 
       make_model(&quot;X -&gt; Y&quot;) |&gt; 
       update_model(data.frame(X = rep(0:1,5), Y = rep(0:1,5)),
                    refresh = 0, iter = 3000),
     censored = 
       make_model(&quot;X -&gt; Y&quot;) |&gt; 
       update_model(data.frame(X = rep(0:1,5), Y = rep(0:1,5)),
                    censored_types = c(&quot;X1Y0&quot;,  &quot;X0Y1&quot;),
                    refresh = 0, iter = 3000))  |&gt;
  query_model(te(&quot;X&quot;, &quot;Y&quot;), using = &quot;posteriors&quot;) |&gt;
  dplyr::select(model, query, mean, sd) |&gt;
  knitr::kable(
    digits = 2,
    booktabs = TRUE,
    align = &quot;c&quot;,
    escape = TRUE, 
    linesep = &quot;&quot;) |&gt; 
  kableExtra::kable_classic_2()
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> model </th>
   <th style="text-align:center;"> query </th>
   <th style="text-align:center;"> mean </th>
   <th style="text-align:center;"> sd </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> uncensored </td>
   <td style="text-align:center;"> (Y[X=1] - Y[X=0]) </td>
   <td style="text-align:center;"> 0.59 </td>
   <td style="text-align:center;"> 0.20 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> censored </td>
   <td style="text-align:center;"> (Y[X=1] - Y[X=0]) </td>
   <td style="text-align:center;"> 0.02 </td>
   <td style="text-align:center;"> 0.32 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">## lipids_model |&gt;
##   grab(&quot;posterior_distribution&quot;)
## 
</code></pre>
<pre><code class="language-r">## lipids_model &lt;-
##   lipids_model |&gt;
##   update_model(keep_fit = TRUE,
##                keep_event_probabilities = TRUE)
## 
</code></pre>
<pre><code class="language-r">## lipids_model |&gt;
##   grab(&quot;stan_summary&quot;)
## 
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; realise_outcomes()
</code></pre>
<pre><code>##      X Y
## 0.00 0 0
## 1.00 1 0
## 0.10 0 1
## 1.10 1 0
## 0.01 0 0
## 1.01 1 1
## 0.11 0 1
## 1.11 1 1
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; realise_outcomes(dos = list(X = 1))
</code></pre>
<pre><code>##      X Y
## 0.00 1 0
## 1.00 1 0
## 0.10 1 0
## 1.10 1 0
## 0.01 1 1
## 1.01 1 1
## 0.11 1 1
## 1.11 1 1
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;)  |&gt; get_query_types(&quot;Y==1&quot;)
</code></pre>
<pre><code>## 
## Causal types satisfying query's condition(s)  
## 
##  query =  Y==1 
## 
## X0.Y10  X1.Y01
## X0.Y11  X1.Y11
## 
## 
##  Number of causal types that meet condition(s) =  4
##  Total number of causal types in model =  8
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;)  |&gt; get_query_types(&quot;Y[X=1]==1&quot;)
</code></pre>
<pre><code>## 
## Causal types satisfying query's condition(s)  
## 
##  query =  Y[X=1]==1 
## 
## X0.Y01  X1.Y01
## X0.Y11  X1.Y11
## 
## 
##  Number of causal types that meet condition(s) =  4
##  Total number of causal types in model =  8
</code></pre>
<pre><code class="language-r">make_model(&quot;X1 -&gt; Y &lt;- X2&quot;)  |&gt;
  get_query_types(&quot;X1==1 &amp; X2==1 &amp; (Y[X1=1, X2=1] &gt; Y[X1=0, X2=0])&quot;)
</code></pre>
<pre><code>## 
## Causal types satisfying query's condition(s)  
## 
##  query =  X1==1&amp;X2==1&amp;(Y[X1=1,X2=1]&gt;Y[X1=0,X2=0]) 
## 
## X11.X21.Y0001  X11.X21.Y0101
## X11.X21.Y0011  X11.X21.Y0111
## 
## 
##  Number of causal types that meet condition(s) =  4
##  Total number of causal types in model =  64
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;)  |&gt; get_query_types(&quot;Y[X=1] - Y[X=0]&quot;)
</code></pre>
<pre><code>## X0.Y00 X1.Y00 X0.Y10 X1.Y10 X0.Y01 X1.Y01 X0.Y11 X1.Y11 
##      0      0     -1     -1      1      1      0      0
</code></pre>
<pre><code class="language-r">data  &lt;- data.frame(X = rep(0:1, 50), Y = rep(0:1, 50))

model &lt;- 
  make_model(&quot;X -&gt; Y&quot;) |&gt;
  update_model(data, iter  = 4000, refresh = 0)

model |&gt; grab(&quot;posterior_distribution&quot;)  |&gt; 
  ggplot(aes(Y.01 - Y.10)) + geom_histogram() 
</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</code></pre>
<div class="figure" style="text-align: center">
<img src="data:image/png;base64,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" alt="Posterior on &quot;Probability $Y$ is increasing in $X$&quot;." width="60%" />
<p class="caption">Posterior on "Probability $Y$ is increasing in $X$".</p>
</div>
<pre><code class="language-r">lipids_model |&gt;
  query_model(query = &quot;Y[X=1] - Y[X=0]&quot;,
              given = c(&quot;X==1 &amp; Y==1 &amp; Z==1&quot;),
              using = &quot;posteriors&quot;) |&gt; 
  dplyr::select(query, given, mean, sd, starts_with(&quot;cred&quot;)) |&gt;
  knitr::kable(
    digits = 2,
    booktabs = TRUE,
    align = &quot;c&quot;,
    escape = TRUE, 
    linesep = &quot;&quot;) |&gt; 
  kableExtra::kable_classic_2(latex_options = c(&quot;scale_down&quot;, &quot;hold_position&quot;))
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> query </th>
   <th style="text-align:center;"> given </th>
   <th style="text-align:center;"> mean </th>
   <th style="text-align:center;"> sd </th>
   <th style="text-align:center;"> cred.low </th>
   <th style="text-align:center;"> cred.high </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> X==1 &amp; Y==1 &amp; Z==1 </td>
   <td style="text-align:center;"> 0.95 </td>
   <td style="text-align:center;"> 0.04 </td>
   <td style="text-align:center;"> 0.86 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">make_model(&quot;X -&gt; M -&gt; Y&quot;) |&gt;
  update_model(data.frame(X = rep(0:1, 8), Y = rep(0:1, 8)), iter = 4000) |&gt;
  query_model(&quot;Y[X=1] &gt; Y[X=0]&quot;, 
              given = &quot;X==1 &amp; Y==1 &amp; M==1&quot;, 
              using = &quot;posteriors&quot;,
              case_level = c(TRUE, FALSE)) 
</code></pre>
<pre><code>## 
## Causal queries generated by query_model
## 
## |query           |given              |using      |case_level |  mean|    sd| cred.low| cred.high|
## |:---------------|:------------------|:----------|:----------|-----:|-----:|--------:|---------:|
## |Y[X=1] &gt; Y[X=0] |X==1 &amp; Y==1 &amp; M==1 |posteriors |TRUE       | 0.676|    NA|    0.676|     0.676|
## |Y[X=1] &gt; Y[X=0] |X==1 &amp; Y==1 &amp; M==1 |posteriors |FALSE      | 0.434| 0.327|    0.003|     0.942|
</code></pre>
<pre><code class="language-r">models &lt;- list(
 `1` = make_model(&quot;X -&gt; Y&quot;)  |&gt; 
        update_model( data.frame(X = rep(0:1, 10), 
                                 Y = rep(0:1,10)), refresh = 0),
 `2` = make_model(&quot;X -&gt; Y&quot;)  |&gt;  set_restrictions(&quot;Y[X=1] &lt; Y[X=0]&quot;) |&gt;
        update_model( data.frame(X = rep(0:1, 10), 
                                 Y = rep(0:1,10)), refresh = 0))


query_model(
  models,
  query = list(ATE = &quot;Y[X=1] - Y[X=0]&quot;, 
               POS = &quot;Y[X=1] &gt; Y[X=0]&quot;),
  given = c(TRUE,  &quot;Y==1 &amp; X==1&quot;),
  case_level = c(FALSE, TRUE),
  using = c(&quot;priors&quot;, &quot;posteriors&quot;),
  expand_grid = TRUE) |&gt;
  dplyr::select(-starts_with(&quot;cred&quot;)) |&gt; 
  knitr::kable(
    digits = 2,
    booktabs = TRUE,
    align = &quot;c&quot;,
    escape = TRUE,
    longtable = TRUE,
    linesep = &quot;&quot;) |&gt; 
  kableExtra::kable_classic_2(latex_options = c(&quot;hold_position&quot;))
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> model </th>
   <th style="text-align:center;"> query </th>
   <th style="text-align:center;"> given </th>
   <th style="text-align:center;"> using </th>
   <th style="text-align:center;"> case_level </th>
   <th style="text-align:center;"> mean </th>
   <th style="text-align:center;"> sd </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> 0.31 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.33 </td>
   <td style="text-align:center;"> 0.24 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.75 </td>
   <td style="text-align:center;"> 0.13 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.84 </td>
   <td style="text-align:center;"> 0.11 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.50 </td>
   <td style="text-align:center;"> 0.29 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.50 </td>
   <td style="text-align:center;"> 0.29 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.91 </td>
   <td style="text-align:center;"> 0.08 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.91 </td>
   <td style="text-align:center;"> 0.09 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.25 </td>
   <td style="text-align:center;"> 0.19 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.33 </td>
   <td style="text-align:center;"> 0.24 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.80 </td>
   <td style="text-align:center;"> 0.11 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.84 </td>
   <td style="text-align:center;"> 0.11 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.50 </td>
   <td style="text-align:center;"> 0.29 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.50 </td>
   <td style="text-align:center;"> 0.29 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.91 </td>
   <td style="text-align:center;"> 0.08 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.91 </td>
   <td style="text-align:center;"> 0.09 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.33 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.75 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.84 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.50 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.50 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.91 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.91 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.25 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.33 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.80 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.84 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.50 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.50 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.91 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.91 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">CausalQueries:::stanmodels$simplexes
</code></pre>
<pre><code>S4 class stanmodel 'simplexes' coded as follows:
functions{
  row_vector col_sums(matrix X) {
    row_vector[cols(X)] s ;
    s = rep_row_vector(1, rows(X)) * X ;
    return s ;
  }
}
data {
int&lt;lower=1&gt; n_params;
int&lt;lower=1&gt; n_paths;
int&lt;lower=1&gt; n_types;
int&lt;lower=1&gt; n_param_sets;
int&lt;lower=1&gt; n_nodes;
array[n_param_sets] int&lt;lower=1&gt; n_param_each;
int&lt;lower=1&gt; n_data;
int&lt;lower=1&gt; n_events;
int&lt;lower=1&gt; n_strategies;
int&lt;lower=0, upper=1&gt; keep_type_distribution;
vector&lt;lower=0&gt;[n_params] lambdas_prior;
array[n_param_sets] int&lt;lower=1&gt; l_starts;
array[n_param_sets] int&lt;lower=1&gt; l_ends;
array[n_nodes] int&lt;lower=1&gt; node_starts;
array[n_nodes] int&lt;lower=1&gt; node_ends;
array[n_strategies] int&lt;lower=1&gt; strategy_starts;
array[n_strategies] int&lt;lower=1&gt; strategy_ends;
matrix[n_params, n_types] P;
matrix[n_params, n_paths] parmap;
matrix[n_paths, n_data] map;
matrix&lt;lower=0,upper=1&gt;[n_events,n_data] E;
array[n_events] int&lt;lower=0&gt; Y;
}
parameters {
vector&lt;lower=0&gt;[n_params - n_param_sets] gamma;
}
transformed parameters {
vector&lt;lower=0, upper=1&gt;[n_params] lambdas;
vector&lt;lower=1&gt;[n_param_sets] sum_gammas;
matrix[n_params, n_paths] parlam;
matrix[n_nodes, n_paths] parlam2;
vector&lt;lower=0, upper=1&gt;[n_paths] w_0;
vector&lt;lower=0, upper=1&gt;[n_data] w;
vector&lt;lower=0, upper=1&gt;[n_events] w_full;
// Cases in which a parameter set has only one value need special handling
// they have no gamma components and sum_gamma needs to be made manually
for (i in 1:n_param_sets) {
  if (l_starts[i] &gt;= l_ends[i]) {
    sum_gammas[i] = 1;
    // syntax here to return unity as a vector
    lambdas[l_starts[i]] = lambdas_prior[1]/lambdas_prior[1];
    }
  else if (l_starts[i] &lt; l_ends[i]) {
    sum_gammas[i] =
    1 + sum(gamma[(l_starts[i] - (i-1)):(l_ends[i] - i)]);
    lambdas[l_starts[i]:l_ends[i]] =
    append_row(1, gamma[(l_starts[i] - (i-1)):(l_ends[i] - i)]) /
      sum_gammas[i];
    }
  }
// Mapping from parameters to data types
// (usual case): [n_par * n_data] * [n_par * n_data]
parlam  = rep_matrix(lambdas, n_paths) .* parmap;
// Sum probability over nodes on each path
for (i in 1:n_nodes) {
 parlam2[i,] = col_sums(parlam[(node_starts[i]):(node_ends[i]),]);
 }
// then take product  to get probability of data type on path
for (i in 1:n_paths) {
  w_0[i] = prod(parlam2[,i]);
 }
 // last (if confounding): map to n_data columns instead of n_paths
 w = map'*w_0;
  // Extend/reduce to cover all observed data types
 w_full = E * w;
}
model {
// Dirichlet distributions
for (i in 1:n_param_sets) {
  target += dirichlet_lpdf(lambdas[l_starts[i]:l_ends[i]]  |
    lambdas_prior[l_starts[i] :l_ends[i]]);
  target += -n_param_each[i] * log(sum_gammas[i]);
 }
// Multinomials
// Note with censoring event_probabilities might not sum to 1
for (i in 1:n_strategies) {
  target += multinomial_lpmf(
  Y[strategy_starts[i]:strategy_ends[i]] |
    w_full[strategy_starts[i]:strategy_ends[i]]/
     sum(w_full[strategy_starts[i]:strategy_ends[i]]));
 }
}
// Option to export distribution of causal types
generated quantities{
vector[n_types] types;
if (keep_type_distribution == 1){
for (i in 1:n_types) {
   types[i] = prod(P[, i].*lambdas + 1 - P[,i]);
}}
 if (keep_type_distribution == 0){
    types = rep_vector(1, n_types);
 }
} 
</code></pre>
</div>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>
</body>
</html>
