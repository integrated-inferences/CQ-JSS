<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="generator" content="litedown 0.7">
<title>Replication code for ‘Making, Updating, and Querying Causal Models using CausalQueries’</title>
<style type="text/css">
body {
  font-family: sans-serif;
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 1.5;
  print-color-adjust: exact;
  -webkit-print-color-adjust: exact;
}
body, .abstract, code, .footnotes, footer, #refs, .caption { font-size: .9em; }
li li { font-size: .95em; }
ul:has(li > input[type="checkbox"]) { list-style: none; padding-left: 1em; }
*, :before, :after { box-sizing: border-box; }
a { color: steelblue; }
pre, img { max-width: 100%; }
pre { white-space: pre-wrap; word-break: break-word; }
pre code { display: block; padding: 1em; overflow-x: auto; }
code { font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace; }
:not(pre, th) > code, code[class], div > .caption { background: #f8f8f8; }
pre > code:is(:not([class]), .language-plain, .language-none, .plain), .box, .figure, .table { background: inherit; border: 1px solid #eee; }
pre > code {
  &.message { border-color: #9eeaf9; }
  &.warning { background: #fff3cd; border-color: #fff3cd; }
  &.error { background: #f8d7da; border-color: #f8d7da; }
}
.fenced-chunk { border-left: 1px solid #666; }
.code-fence {
  opacity: .4;
  border: 1px dashed #666;
  border-left: 2px solid;
  &:hover { opacity: inherit; }
}
.box, .figure, .table, table { margin: 1em auto; }
div > .caption { padding: 1px 1em; }
.figure { p:has(img, svg), pre:has(svg) { text-align: center; } }
.flex-col { display: flex; justify-content: space-between; }
table {
  &:only-child:not(.table > *) { margin: auto; }
  th, td { padding: 5px; font-variant-numeric: tabular-nums; }
  thead, tfoot, tr:nth-child(even) { background: whitesmoke; }
  thead th { border-bottom: 1px solid #ddd; }
  &:not(.datatable-table) {
    border-top: 1px solid #666;
    border-bottom: 1px solid #666;
  }
}
blockquote {
  color: #666;
  margin: 0;
  padding: 1px 1em;
  border-left: .5em solid #eee;
}
hr, .footnotes::before { border: 1px dashed #ddd; }
.frontmatter { text-align: center; }
#TOC {
  a { text-decoration: none; }
  ul { list-style: none; padding-left: 1em; }
  & > ul { padding: 0; }
  ul ul { border-left: 1px solid lightsteelblue; }
}
.body h2 { border-bottom: 1px solid #666; }
.body .appendix, .appendix ~ h2 { border-bottom-style: dashed; }
.main-number::after { content: "."; }
span[class^="ref-number-"] { font-weight: bold; }
.ref-number-fig::after, .ref-number-tab::after { content: ":"; }
.cross-ref-chp::before { content: "Chapter "; }
.cross-ref-sec::before { content: "Section "; }
.cross-ref-fig::before, .ref-number-fig::before { content: "Figure "; }
.cross-ref-tab::before, .ref-number-tab::before { content: "Table "; }
.cross-ref-eqn::before, .MathJax_ref:has(mjx-mtext > mjx-c + mjx-c)::before { content: "Equation "; }
.abstract, #refs {
  &::before { display: block; margin: 1em auto; font-weight: bold; }
}
.abstract::before { content: "Abstract"; text-align: center; }
#refs::before { content: "Bibliography"; font-size: 1.5em; }
.ref-paren-open::before { content: "("; }
.ref-paren-close::after { content: ")"; }
.ref-semicolon::after { content: "; "; }
.ref-and::after { content: " and "; }
.ref-et-al::after { content: " et al."; font-style: italic; }
.footnote-ref a {
  &::before { content: "["; }
  &::after { content: "]"; }
}
section.footnotes {
  margin-top: 2em;
  &::before { content: ""; display: block; max-width: 20em; }
}
.fade {
  background: repeating-linear-gradient(135deg, white, white 30px, #ddd 32px, #ddd 32px);
  opacity: 0.6;
}

@media print {
  body { max-width: 100%; }
  tr, img { break-inside: avoid; }
}
@media only screen and (min-width: 992px) {
  body:not(.pagesjs) pre:has(.line-numbers):not(:hover) { white-space: pre; }
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@1.14.14/css/prism-xcode.min.css">
<script src="https://cdn.jsdelivr.net/combine/npm/katex@0.16.22/dist/katex.min.js,npm/katex@0.16.22/dist/contrib/auto-render.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xiee/utils@1.14.14/js/render-katex.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>
</head>
<body>
<div class="frontmatter">
<div class="title"><h1>Replication code for ‘Making, Updating, and Querying Causal Models using CausalQueries’</h1></div>
<div class="author"><h2>Till Tietz, Lily Medina, Georgiy Syunyaev, and Macartan Humphreys</h2></div>
<div class="date"><h3>2025-08-05</h3></div>
</div>
<div class="body">
<p>Generated by <code>knitr::spin()</code> from <code>code.R</code>.</p>
<p>Note: final section of code for microbenchmarking is slow</p>
<h2 id="sec:set-up">Set up</h2>
<pre><code class="language-r">library(&quot;tidyverse&quot;)
</code></pre>
<pre><code>## ── Attaching core tidyverse packages ─────────────────────── tidyverse 2.0.0 ──
## ✔ dplyr     1.1.4     ✔ purrr     1.0.4
## ✔ forcats   1.0.0     ✔ readr     2.1.5
## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
## ── Conflicts ───────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors
</code></pre>
<pre><code class="language-r">library(&quot;CausalQueries&quot;)
library(&quot;microbenchmark&quot;)
library(&quot;parallel&quot;)
library(&quot;future&quot;)
library(&quot;future.apply&quot;)
library(&quot;knitr&quot;)
library(&quot;rstan&quot;)
</code></pre>
<pre><code>## Loading required package: StanHeaders
## 
## rstan version 2.32.7 (Stan version 2.32.2)
## 
## For execution on a local, multicore CPU with excess RAM we recommend calling
## options(mc.cores = parallel::detectCores()).
## To avoid recompilation of unchanged Stan programs, we recommend calling
## rstan_options(auto_write = TRUE)
## For within-chain threading using `reduce_sum()` or `map_rect()` Stan functions,
## change `threads_per_chain` option:
## rstan_options(threads_per_chain = 1)
## 
## Do not specify '-march=native' in 'LOCAL_CPPFLAGS' or a Makevars file
## 
## Attaching package: 'rstan'
## 
## The following object is masked from 'package:tidyr':
## 
##     extract
</code></pre>
<pre><code class="language-r">options(kableExtra.latex.load_packages = FALSE)
library(&quot;kableExtra&quot;)
</code></pre>
<pre><code>## 
## Attaching package: 'kableExtra'
## 
## The following object is masked from 'package:dplyr':
## 
##     group_rows
</code></pre>
<pre><code class="language-r">options(mc.cores = parallel::detectCores())


if (knitr::is_latex_output()) {
  
knitr::knit_hooks$set(source = function(x, options) {


  lines &lt;- unlist(strsplit(x, &quot;\n&quot;))
  prompts &lt;- character(length(lines))
  continuation &lt;- FALSE
  open_brackets &lt;- 0

  for (i in seq_along(lines)) {
    line_trimmed &lt;- trimws(lines[i])

    # Determine if the previous line ends with |&gt; or has unmatched brackets
    if (continuation || open_brackets &gt; 0) {
      prompts[i] &lt;- &quot;+  &quot;
    } else {
      prompts[i] &lt;- &quot;R&gt; &quot;
    }

    # Update brackets count
    open_brackets &lt;- open_brackets +
      stringr::str_count(line_trimmed, &quot;[\\(\\{\\[]&quot;) -
      stringr::str_count(line_trimmed, &quot;[\\)\\}\\]]&quot;)

    # Check if line ends with pipe operator (|&gt;)
    continuation &lt;- grepl(&quot;\\|&gt;\\s*$&quot;, line_trimmed)

    # Reset bracket count on empty lines
    if (line_trimmed == &quot;&quot;) {
      open_brackets &lt;- 0
      continuation &lt;- FALSE
    }
  }

  # Add exactly two spaces indentation to continuation lines starting with &quot;+&quot;
  formatted_lines &lt;- ifelse(
    prompts == &quot;R&gt; &quot;,
    paste0(prompts, trimws(lines, &quot;left&quot;)),
    paste0(prompts, &quot;  &quot;, trimws(lines, &quot;left&quot;))
  )

  paste0(&quot;\\begin{CodeInput}\n&quot;,
         paste(formatted_lines, collapse = &quot;\n&quot;),
         &quot;\n\\end{CodeInput}\n&quot;)
})
}

set.seed(1, &quot;L'Ecuyer-CMRG&quot;)
theme_set(theme_bw())

kabble &lt;- function(
    x, 
    align = &quot;c&quot;, 
    format = ifelse(knitr::is_html_output(), &quot;html&quot;, &quot;latex&quot;), 
    ...) {
  x |&gt;
    knitr::kable(
      format = format,
      digits = 2,
      align = align,
      booktabs = TRUE, 
      linesep = &quot;&quot;,
      longtable = TRUE,
      ...) |&gt;
    kableExtra::kable_classic_2(latex_options = c(&quot;scale_down&quot;))
}
</code></pre>
<h1 id="chp:motivating-example_1">Motivating example</h1>
<pre><code class="language-r">data(&quot;lipids_data&quot;)
lipids_data
</code></pre>
<pre><code>##    event strategy count
## 1 Z0X0Y0      ZXY   158
## 2 Z1X0Y0      ZXY    52
## 3 Z0X1Y0      ZXY     0
## 4 Z1X1Y0      ZXY    23
## 5 Z0X0Y1      ZXY    14
## 6 Z1X0Y1      ZXY    12
## 7 Z0X1Y1      ZXY     0
## 8 Z1X1Y1      ZXY    78
</code></pre>
<h1 id="chp:motivating-example_2">Motivating example</h1>
<pre><code class="language-r">lipids_model &lt;-  make_model(&quot;Z -&gt; X -&gt; Y; X &lt;-&gt; Y&quot;) 
</code></pre>
<pre><code class="language-r">lipids_model &lt;- update_model(lipids_model, lipids_data)
</code></pre>
<pre><code class="language-r">lipids_queries &lt;- query_model(lipids_model, queries = list(
  ATE = &quot;Y[X = 1] - Y[X = 0]&quot;,
  PoC = &quot;Y[X = 1] - Y[X = 0] :|: X == 0 &amp; Y == 0&quot;,
  LATE = &quot;Y[X = 1] - Y[X = 0] :|: X[Z = 1] &gt; X[Z = 0]&quot;),
  using = &quot;posteriors&quot;)
</code></pre>
<pre><code class="language-r">lipids_queries |&gt;
  dplyr::select(label, query, given, mean, sd, starts_with(&quot;cred&quot;)) |&gt;
kabble(align = &quot;c&quot;)
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> label </th>
   <th style="text-align:center;"> query </th>
   <th style="text-align:center;"> given </th>
   <th style="text-align:center;"> mean </th>
   <th style="text-align:center;"> sd </th>
   <th style="text-align:center;"> cred.low </th>
   <th style="text-align:center;"> cred.high </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Y[X = 1] - Y[X = 0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> 0.55 </td>
   <td style="text-align:center;"> 0.10 </td>
   <td style="text-align:center;"> 0.37 </td>
   <td style="text-align:center;"> 0.73 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> PoC </td>
   <td style="text-align:center;"> Y[X = 1] - Y[X = 0] </td>
   <td style="text-align:center;"> X == 0 &amp; Y == 0 </td>
   <td style="text-align:center;"> 0.63 </td>
   <td style="text-align:center;"> 0.15 </td>
   <td style="text-align:center;"> 0.38 </td>
   <td style="text-align:center;"> 0.89 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> LATE </td>
   <td style="text-align:center;"> Y[X = 1] - Y[X = 0] </td>
   <td style="text-align:center;"> X[Z = 1] &gt; X[Z = 0] </td>
   <td style="text-align:center;"> 0.70 </td>
   <td style="text-align:center;"> 0.05 </td>
   <td style="text-align:center;"> 0.59 </td>
   <td style="text-align:center;"> 0.80 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">lipids_queries |&gt; plot()
</code></pre>
<p><img src="data:image/png;base64,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" alt="Illustration of queries plotted." /></p>
<h1 id="chp:statistical-model">Statistical model</h1>
<pre><code class="language-r">with_pars &lt;- 
  lipids_model |&gt;
  set_parameters(param_type = &quot;prior_draw&quot;) 

with_pars |&gt; grab(&quot;parameters_df&quot;) |&gt;
  dplyr::select(node, nodal_type, param_set, param_names, param_value, priors) |&gt; 
  kabble()
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> node </th>
   <th style="text-align:center;"> nodal_type </th>
   <th style="text-align:center;"> param_set </th>
   <th style="text-align:center;"> param_names </th>
   <th style="text-align:center;"> param_value </th>
   <th style="text-align:center;"> priors </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> Z </td>
   <td style="text-align:center;"> 0 </td>
   <td style="text-align:center;"> Z </td>
   <td style="text-align:center;"> Z.0 </td>
   <td style="text-align:center;"> 0.57 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Z </td>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> Z </td>
   <td style="text-align:center;"> Z.1 </td>
   <td style="text-align:center;"> 0.43 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> X.00 </td>
   <td style="text-align:center;"> 0.24 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> X.10 </td>
   <td style="text-align:center;"> 0.30 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> X.01 </td>
   <td style="text-align:center;"> 0.20 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> X.11 </td>
   <td style="text-align:center;"> 0.27 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> Y.X.00 </td>
   <td style="text-align:center;"> Y.00_X.00 </td>
   <td style="text-align:center;"> 0.71 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> Y.X.00 </td>
   <td style="text-align:center;"> Y.10_X.00 </td>
   <td style="text-align:center;"> 0.19 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> Y.X.00 </td>
   <td style="text-align:center;"> Y.01_X.00 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> Y.X.00 </td>
   <td style="text-align:center;"> Y.11_X.00 </td>
   <td style="text-align:center;"> 0.10 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> Y.X.01 </td>
   <td style="text-align:center;"> Y.00_X.01 </td>
   <td style="text-align:center;"> 0.15 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> Y.X.01 </td>
   <td style="text-align:center;"> Y.10_X.01 </td>
   <td style="text-align:center;"> 0.40 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> Y.X.01 </td>
   <td style="text-align:center;"> Y.01_X.01 </td>
   <td style="text-align:center;"> 0.39 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> Y.X.01 </td>
   <td style="text-align:center;"> Y.11_X.01 </td>
   <td style="text-align:center;"> 0.06 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> Y.X.10 </td>
   <td style="text-align:center;"> Y.00_X.10 </td>
   <td style="text-align:center;"> 0.17 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> Y.X.10 </td>
   <td style="text-align:center;"> Y.10_X.10 </td>
   <td style="text-align:center;"> 0.65 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> Y.X.10 </td>
   <td style="text-align:center;"> Y.01_X.10 </td>
   <td style="text-align:center;"> 0.14 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> Y.X.10 </td>
   <td style="text-align:center;"> Y.11_X.10 </td>
   <td style="text-align:center;"> 0.04 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> Y.X.11 </td>
   <td style="text-align:center;"> Y.00_X.11 </td>
   <td style="text-align:center;"> 0.24 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> Y.X.11 </td>
   <td style="text-align:center;"> Y.10_X.11 </td>
   <td style="text-align:center;"> 0.71 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> Y.X.11 </td>
   <td style="text-align:center;"> Y.01_X.11 </td>
   <td style="text-align:center;"> 0.04 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> Y.X.11 </td>
   <td style="text-align:center;"> Y.11_X.11 </td>
   <td style="text-align:center;"> 0.01 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
</tbody>
</table>
<h1 id="chp:making-models">Making models</h1>
<pre><code class="language-r">model &lt;- make_model(&quot;X -&gt; M -&gt; Y &lt;- X&quot;)
</code></pre>
<h2 id="sec:graphing">Graphing</h2>
<pre><code class="language-r">lipids_model |&gt; plot()
lipids_model |&gt; plot(x_coord = 1:3, y_coord = 3:1, textcol = &quot;black&quot;,
  textsize = 3, shape = c(15, 16, 16), nodecol = &quot;lightgrey&quot;, nodesize = 10)
</code></pre>
<div class="figure">
<img src="data:image/png;base64,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" alt="Examples of model graphs." width="50%" /><img src="data:image/png;base64,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" alt="Examples of model graphs." width="50%" />
<p class="caption">Examples of model graphs.</p>
</div>
<h2 id="sec:tailoring-models">Tailoring models</h2>
<pre><code class="language-r">statements &lt;- list(&quot;X -&gt; Y &lt;- W&quot;, 
                   &quot;X -&gt; Y &lt;- W; X &lt;-&gt; W&quot;, 
                   &quot;X -&gt; Y &lt;- W; X &lt;-&gt; Y; W &lt;-&gt; Y&quot;,
                   &quot;X -&gt; Y &lt;- W; X &lt;-&gt; Y; W &lt;-&gt; Y; X &lt;-&gt; W&quot;, 
                   &quot;X -&gt; W -&gt; Y &lt;- X&quot;,
                   &quot;X -&gt; W -&gt; Y &lt;- X; W &lt;-&gt; Y&quot;,
                   &quot;X -&gt; W -&gt; Y &lt;- X; X &lt;-&gt; W; W &lt;-&gt; Y&quot;, 
                   &quot;X -&gt; W -&gt; Y &lt;- X; X &lt;-&gt; W; W &lt;-&gt; Y; X &lt;-&gt; Y&quot;)

dof &lt;- function(statement) {
  make_model(statement, add_causal_types = FALSE) |&gt;
  grab(&quot;parameters_df&quot;)  |&gt;
  group_by(param_set) |&gt;
  summarize(n  = n() - 1) |&gt;
  pull(n) |&gt;
  sum()
}



data.frame(
  Model = c(
  &quot;X → Y ← W&quot;,
  &quot;X → Y ← W; X ←→ W&quot;,
  &quot;X → Y ← W; X ←→ Y; W ←→ Y&quot;,
  &quot;X → Y ← W; X ←→ Y; W ←→ Y; X ←→ W&quot;,
  &quot;X → W → Y ← X&quot;,
  &quot;X → W → Y ← X; W ←→ Y&quot;,
  &quot;X → W → Y ← X; X ←→ W; W ←→ Y&quot;,
  &quot;X → W → Y ← X; X ←→ W; W ←→ Y; X ←→ Y&quot;
),
  dof = unlist(lapply(statements, dof))
) |&gt; 
  kabble(
    col.names = c(&quot;Model&quot;, &quot;Degrees of freedom&quot;),
    align = c(&quot;l&quot;, &quot;c&quot;)
  )
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> Model </th>
   <th style="text-align:center;"> Degrees of freedom </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> X → Y ← W </td>
   <td style="text-align:center;"> 17 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> X → Y ← W; X ←→ W </td>
   <td style="text-align:center;"> 18 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> X → Y ← W; X ←→ Y; W ←→ Y </td>
   <td style="text-align:center;"> 62 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> X → Y ← W; X ←→ Y; W ←→ Y; X ←→ W </td>
   <td style="text-align:center;"> 63 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> X → W → Y ← X </td>
   <td style="text-align:center;"> 19 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> X → W → Y ← X; W ←→ Y </td>
   <td style="text-align:center;"> 64 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> X → W → Y ← X; X ←→ W; W ←→ Y </td>
   <td style="text-align:center;"> 67 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> X → W → Y ← X; X ←→ W; W ←→ Y; X ←→ Y </td>
   <td style="text-align:center;"> 127 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">model_restricted &lt;- lipids_model |&gt; 
  set_restrictions(&quot;X[Z = 1] &lt; X[Z = 0]&quot;)
</code></pre>
<pre><code class="language-r">model &lt;- lipids_model |&gt; set_restrictions(
  labels = list(X = &quot;01&quot;, Y = c(&quot;00&quot;, &quot;01&quot;, &quot;11&quot;)), keep = TRUE)
</code></pre>
<pre><code class="language-r">model &lt;- lipids_model |&gt; set_restrictions(labels = list(Y = &quot;?0&quot;))
</code></pre>
<pre><code class="language-r">model &lt;- lipids_model |&gt; set_restrictions(
  labels = list(Y = c('00', '11')), given = 'X.00')
</code></pre>
<pre><code class="language-r">lipids_model |&gt; inspect(&quot;prior_hyperparameters&quot;, nodes = &quot;X&quot;) 
</code></pre>
<pre><code>## 
## prior_hyperparameters
## Alpha parameter values used for Dirichlet prior distributions:
## 
## X.00 X.10 X.01 X.11 
##    1    1    1    1
</code></pre>
<pre><code class="language-r">model &lt;- lipids_model |&gt; set_priors(distribution = &quot;jeffreys&quot;)
</code></pre>
<pre><code>## Altering all parameters.
</code></pre>
<pre><code class="language-r">lipids_model |&gt; set_priors(
  param_names = c(&quot;X.10&quot;, &quot;X.01&quot;), alphas = 3:4) |&gt; 
  inspect(&quot;prior_hyperparameters&quot;, nodes = &quot;X&quot;)
</code></pre>
<pre><code>## 
## prior_hyperparameters
## Alpha parameter values used for Dirichlet prior distributions:
## 
## X.00 X.10 X.01 X.11 
##    1    3    4    1
</code></pre>
<pre><code class="language-r">lipids_model |&gt; set_priors(
  statement = &quot;X[Z = 1] &gt; X[Z = 0]&quot;, alphas = 3) |&gt;
  inspect(&quot;prior_hyperparameters&quot;, nodes = &quot;X&quot;)
</code></pre>
<pre><code>## 
## prior_hyperparameters
## Alpha parameter values used for Dirichlet prior distributions:
## 
## X.00 X.10 X.01 X.11 
##    1    1    3    1
</code></pre>
<pre><code class="language-r">query &lt;- make_model(&quot;X -&gt; Y&quot;) |&gt; 
  set_restrictions(decreasing(&quot;X&quot;, &quot;Y&quot;)) |&gt;
  query_model(&quot;Y[X = 1] - Y[X = 0]&quot;, using = &quot;priors&quot;)
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; inspect(&quot;parameters&quot;)
</code></pre>
<pre><code>## 
## parameters
## Model parameters with associated probabilities: 
## 
##  X.0  X.1 Y.00 Y.10 Y.01 Y.11 
## 0.50 0.50 0.25 0.25 0.25 0.25
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; set_parameters(
  statement = &quot;Y[X = 1] &gt; Y[X = 0]&quot;, parameters = .7) |&gt;
  inspect(&quot;parameters&quot;)
</code></pre>
<pre><code>## 
## parameters
## Model parameters with associated probabilities: 
## 
##  X.0  X.1 Y.00 Y.10 Y.01 Y.11 
##  0.5  0.5  0.1  0.1  0.7  0.1
</code></pre>
<h2 id="sec:drawing-and-manipulating-data">Drawing and manipulating data</h2>
<pre><code class="language-r">lipids_model |&gt; make_data(n = 4)
</code></pre>
<pre><code>##   Z X Y
## 1 0 1 1
## 2 1 0 0
## 3 1 1 1
## 4 1 1 1
</code></pre>
<pre><code class="language-r">sample_data &lt;- lipids_model |&gt; make_data(
  n = 8, nodes = list(c(&quot;Z&quot;, &quot;Y&quot;), &quot;X&quot;), probs = list(1, .5),
  subsets = list(TRUE, &quot;Z == 1 &amp; Y == 0&quot;))
</code></pre>
<pre><code class="language-r">sample_data |&gt; collapse_data(lipids_model)
</code></pre>
<pre><code>##     event strategy count
## 1  Z0X0Y0      ZXY     0
## 2  Z1X0Y0      ZXY     0
## 3  Z0X1Y0      ZXY     0
## 4  Z1X1Y0      ZXY     0
## 5  Z0X0Y1      ZXY     1
## 6  Z1X0Y1      ZXY     0
## 7  Z0X1Y1      ZXY     0
## 8  Z1X1Y1      ZXY     0
## 9    Z0Y0       ZY     2
## 10   Z1Y0       ZY     1
## 11   Z0Y1       ZY     2
## 12   Z1Y1       ZY     2
</code></pre>
<h1 id="chp:updating-models">Updating models</h1>
<h2 id="sec:how-the-stan-program-works">How the Stan program works</h2>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; inspect(&quot;parameter_mapping&quot;) 
</code></pre>
<pre><code>## 
## parameter_mapping (Parameter mapping matrix) 
## 
##   Maps from parameters to data types, with
##   possibly multiple columns for each data type
##   in cases with confounding. 
## 
##      X0Y0 X1Y0 X0Y1 X1Y1
## X.0     1    0    1    0
## X.1     0    1    0    1
## Y.00    1    1    0    0
## Y.10    0    1    1    0
## Y.01    1    0    0    1
## Y.11    0    0    1    1
</code></pre>
<h2 id="sec:incomplete-and-censored-data">Incomplete and censored data</h2>
<pre><code class="language-r">data &lt;- data.frame(X = rep(0:1, 5), Y = rep(0:1, 5))
list(uncensored = update_model(make_model(&quot;X -&gt; Y&quot;), 
  data = data, refresh = 0),
    censored = update_model(make_model(&quot;X -&gt; Y&quot;), data = data, 
    censored_types = c(&quot;X1Y0&quot;,  &quot;X0Y1&quot;), refresh = 0)) |&gt;
  query_model(&quot;Y[X = 1] - Y[X = 0]&quot;, using = &quot;posteriors&quot;) |&gt;
  dplyr::select(-using)
</code></pre>
<pre><code>## 
## Causal queries generated by query_model
## 
## |model      |case_level |  mean|    sd| cred.low| cred.high|
## |:----------|:----------|-----:|-----:|--------:|---------:|
## |uncensored |FALSE      | 0.590| 0.196|    0.145|     0.897|
## |censored   |FALSE      | 0.015| 0.318|   -0.625|     0.641|
</code></pre>
<h2 id="sec:output">Output</h2>
<pre><code class="language-r">model &lt;- make_model(&quot;X -&gt; Y&quot;) |&gt; update_model()
posterior &lt;- inspect(model, &quot;posterior_distribution&quot;)  
</code></pre>
<pre><code>## 
## posterior_distribution
## Summary statistics of model parameters posterior distributions:
## 
##   Distributions matrix dimensions are 
##   4000 rows (draws) by 6 cols (parameters)
## 
##      mean   sd
## X.0  0.49 0.29
## X.1  0.51 0.29
## Y.00 0.25 0.20
## Y.10 0.26 0.20
## Y.01 0.25 0.19
## Y.11 0.24 0.19
</code></pre>
<pre><code class="language-r">lipids_model &lt;- lipids_model |&gt; update_model(
  keep_fit = TRUE, keep_event_probabilities = TRUE)
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; update_model(keep_type_distribution = FALSE, 
  refresh = 0) |&gt; inspect(&quot;stan_summary&quot;) 
</code></pre>
<pre><code>## 
## stan_summary
## Stan model summary:
## 
## Inference for Stan model: simplexes.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##                    mean se_mean   sd   2.5%   25%   50%   75% 97.5% n_eff Rhat
## X.0                0.49    0.01 0.29   0.02  0.24  0.49  0.75  0.97  2976 1.00
## X.1                0.51    0.01 0.29   0.03  0.25  0.51  0.76  0.98  2976 1.00
## Y.00               0.25    0.01 0.19   0.01  0.09  0.20  0.37  0.71  1419 1.00
## Y.10               0.25    0.00 0.19   0.01  0.09  0.20  0.37  0.71  4026 1.00
## Y.01               0.25    0.00 0.19   0.01  0.09  0.21  0.37  0.71  4142 1.00
## Y.11               0.25    0.00 0.20   0.01  0.09  0.20  0.37  0.71  4265 1.00
## lp__               1.02    0.02 1.00   0.03  0.29  0.71  1.43  3.75  2419 1.00
## log_sum_gammas[2]  1.86    0.05 1.27   0.34  0.99  1.59  2.42  4.99   649 1.01
## lp__              -7.58    0.05 1.72 -11.74 -8.44 -7.17 -6.34 -5.43  1185 1.00
## 
## Samples were drawn using NUTS(diag_e) at Tue Aug  5 00:13:42 2025.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).
</code></pre>
<h2 id="sec:convergence-problems-and-diagnostics">Convergence problems and diagnostics</h2>
<pre><code class="language-r">model &lt;- make_model(&quot;X -&gt; M -&gt; Y&quot;) |&gt; update_model(
  data = data.frame(X = rep(0:1, 10000), Y = rep(0:1, 10000)), 
  iter = 5000, refresh = 0)
</code></pre>
<pre><code class="language-r">model
</code></pre>
<pre><code>## 
## Causal statement: 
## M -&gt; Y; X -&gt; M
## 
## Number of nodal types by node:
## X M Y 
## 2 4 4 
## 
## Number of causal types: 32
## 
## Model has been updated and contains a posterior distribution with
## 4 chains, each with iter=5000; warmup=2500; thin=1;  
## Use inspect(model, 'stan_summary') to inspect stan summary
## 
## Warnings passed from rstan during updating:
## The largest R-hat is 1.53, indicating chains have not mixed
## Bulk Effective Samples Size (ESS) is too low
## Tail Effective Samples Size (ESS) is too low
</code></pre>
<pre><code class="language-r">model &lt;- make_model(&quot;X -&gt; Y&quot;) |&gt; 
  update_model(refresh = 0, keep_fit = TRUE)
</code></pre>
<pre><code class="language-r">model |&gt; inspect(&quot;stanfit&quot;)
</code></pre>
<pre><code>## 
## stanfit
## Stan model summary:
## Inference for Stan model: simplexes.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##                    mean se_mean   sd   2.5%   25%   50%   75% 97.5% n_eff Rhat
## lambdas[1]         0.50    0.01 0.29   0.03  0.25  0.49  0.74  0.97  3036 1.00
## lambdas[2]         0.50    0.01 0.29   0.03  0.26  0.51  0.75  0.97  3036 1.00
## lambdas[3]         0.25    0.00 0.19   0.01  0.09  0.21  0.37  0.70  2031 1.00
## lambdas[4]         0.25    0.00 0.19   0.01  0.09  0.21  0.37  0.71  4633 1.00
## lambdas[5]         0.25    0.00 0.20   0.01  0.09  0.20  0.37  0.72  4162 1.00
## lambdas[6]         0.25    0.00 0.20   0.01  0.09  0.20  0.37  0.71  4701 1.00
## log_sum_gammas[1]  1.00    0.02 0.96   0.03  0.30  0.72  1.39  3.43  2536 1.00
## log_sum_gammas[2]  1.85    0.03 1.19   0.36  1.00  1.58  2.41  4.93  1159 1.01
## types[1]           0.12    0.00 0.13   0.00  0.03  0.08  0.18  0.50  2065 1.00
## types[2]           0.13    0.00 0.13   0.00  0.03  0.08  0.18  0.48  2390 1.00
## types[3]           0.12    0.00 0.13   0.00  0.03  0.08  0.18  0.50  3785 1.00
## types[4]           0.13    0.00 0.13   0.00  0.03  0.08  0.18  0.49  3407 1.00
## types[5]           0.12    0.00 0.13   0.00  0.03  0.08  0.18  0.48  3507 1.00
## types[6]           0.13    0.00 0.13   0.00  0.03  0.08  0.18  0.49  3619 1.00
## types[7]           0.12    0.00 0.13   0.00  0.03  0.08  0.17  0.49  3841 1.00
## types[8]           0.13    0.00 0.13   0.00  0.03  0.08  0.19  0.49  3863 1.00
## lp__              -7.53    0.04 1.65 -11.75 -8.37 -7.15 -6.32 -5.44  1368 1.00
## 
## Samples were drawn using NUTS(diag_e) at Tue Aug  5 00:13:57 2025.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).
</code></pre>
<h1 id="chp:querying-models">Querying models</h1>
<h2 id="sec:calculating-factual-and-counterfactual-quantities">Calculating factual and counterfactual quantities</h2>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; realise_outcomes()
</code></pre>
<pre><code>##      X Y
## 0.00 0 0
## 1.00 1 0
## 0.10 0 1
## 1.10 1 0
## 0.01 0 0
## 1.01 1 1
## 0.11 0 1
## 1.11 1 1
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; realise_outcomes(dos = list(X = 1))
</code></pre>
<pre><code>##      X Y
## 0.00 1 0
## 1.00 1 0
## 0.10 1 0
## 1.10 1 0
## 0.01 1 1
## 1.01 1 1
## 0.11 1 1
## 1.11 1 1
</code></pre>
<h2 id="sec:causal-syntax">Causal syntax</h2>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;)  |&gt; get_query_types(&quot;Y == 1&quot;)
</code></pre>
<pre><code>## 
## Causal types satisfying query's condition(s)  
## 
##  query =  Y==1 
## 
## X0.Y10  X1.Y01
## X0.Y11  X1.Y11
## 
## 
##  Number of causal types that meet condition(s) =  4
##  Total number of causal types in model =  8
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; get_query_types(&quot;Y[X = 0] == 1&quot;)
</code></pre>
<pre><code>## 
## Causal types satisfying query's condition(s)  
## 
##  query =  Y[X=0]==1 
## 
## X0.Y10  X1.Y10
## X0.Y11  X1.Y11
## 
## 
##  Number of causal types that meet condition(s) =  4
##  Total number of causal types in model =  8
</code></pre>
<pre><code class="language-r">make_model(&quot;X1 -&gt; Y &lt;- X2&quot;)  |&gt; get_query_types(
  &quot;X1 == 1 &amp; X2 == 1 &amp; (Y[X1 = 1, X2 = 1] &gt; Y[X1 = 0, X2 = 0])&quot;)
</code></pre>
<pre><code>## 
## Causal types satisfying query's condition(s)  
## 
##  query =  X1==1&amp;X2==1&amp;(Y[X1=1,X2=1]&gt;Y[X1=0,X2=0]) 
## 
## X11.X21.Y0001  X11.X21.Y0101
## X11.X21.Y0011  X11.X21.Y0111
## 
## 
##  Number of causal types that meet condition(s) =  4
##  Total number of causal types in model =  64
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt; get_query_types(&quot;Y[X = 1] - Y[X = 0]&quot;)
</code></pre>
<pre><code>## X0.Y00 X1.Y00 X0.Y10 X1.Y10 X0.Y01 X1.Y01 X0.Y11 X1.Y11 
##      0      0     -1     -1      1      1      0      0
</code></pre>
<h2 id="sec:quantifying-queries">Quantifying queries</h2>
<pre><code class="language-r">data  &lt;- data.frame(X = rep(0:1, 50), Y = rep(0:1, 50))

model &lt;-  make_model(&quot;X -&gt; Y&quot;) |&gt; update_model(
  data, iter = 4000, refresh = 0)

model |&gt; grab(&quot;posterior_distribution&quot;)  |&gt; 
  ggplot(aes(Y.01 - Y.10)) + geom_histogram() 
</code></pre>
<div class="figure" style="text-align: center">
<img src="data:image/png;base64,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" alt="Posterior on "Probability \(Y\) is increasing in \(X\)"." width="60%" />
<p class="caption">Posterior on "Probability \(Y\) is increasing in \(X\)".</p>
</div>
<pre><code class="language-r">queries &lt;- make_model(&quot;X -&gt; Y&quot;) |&gt; query_distribution(
  query = list(increasing = &quot;(Y[X = 1] &gt; Y[X = 0])&quot;, 
    ATE = &quot;(Y[X = 1] - Y[X = 0])&quot;), using = &quot;priors&quot;)
</code></pre>
<pre><code class="language-r">lipids_model |&gt; query_model(
    query = &quot;Y[X = 1] - Y[X = 0] :|: X == 1 &amp; Y == 1 &amp; Z == 1&quot;,
    using = &quot;posteriors&quot;) |&gt; plot()
</code></pre>
<p><img src="data:image/png;base64,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" alt="Illustration of case-level queries plotted." /></p>
<pre><code class="language-r">make_model(&quot;X -&gt; M -&gt; Y&quot;) |&gt; update_model(
  data.frame(X = rep(0:1, 8), Y = rep(0:1, 8)), iter = 4000, refresh = 0) |&gt;
  query_model(&quot;Y[X = 1] &gt; Y[X = 0] :|: X == 1 &amp; Y == 1 &amp; M == 1&quot;, 
  using = &quot;posteriors&quot;, case_level = c(TRUE, FALSE)) |&gt;
  plot()
</code></pre>
<p><img src="data:image/png;base64,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" alt="Illustration of new case-level queries plotted." /></p>
<pre><code class="language-r">models &lt;- list(
  Unrestricted = lipids_model |&gt; 
    update_model(data = lipids_data, refresh = 0),
  Restricted = lipids_model |&gt; set_restrictions(&quot;X[Z = 1] &lt; X[Z = 0]&quot;) |&gt; 
    update_model(data = lipids_data, refresh = 0)
)
</code></pre>
<pre><code class="language-r">queries &lt;- 
  query_model(
    models, 
     query = list(
       ATE = &quot;Y[X=1] - Y[X=0]&quot;, 
       POS = &quot;Y[X=1] &gt; Y[X=0] :|: Y==1 &amp; X==1&quot;),
    case_level = c(FALSE, TRUE), 
    using = c(&quot;priors&quot;, &quot;posteriors&quot;),
    expand_grid = TRUE)
</code></pre>
<pre><code class="language-r">queries |&gt;
  dplyr::select(-starts_with(&quot;cred&quot;), -sd) |&gt; 
  kabble(align = &quot;c&quot;) 
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> label </th>
   <th style="text-align:center;"> model </th>
   <th style="text-align:center;"> query </th>
   <th style="text-align:center;"> given </th>
   <th style="text-align:center;"> using </th>
   <th style="text-align:center;"> case_level </th>
   <th style="text-align:center;"> mean </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.56 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.55 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.50 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.49 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.95 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.95 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.56 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.55 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.50 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.49 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.95 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.95 </td>
  </tr>
</tbody>
</table>
<p>default plot associated with this query:</p>
<pre><code class="language-r">queries |&gt; plot()
</code></pre>
<p><img src="data:image/png;base64,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" alt="Default plotting for a a set of queries over multiple models." /></p>
<h1 id="chp:appendix-a-parallelization">Appendix A: Parallelization</h1>
<pre><code class="language-r">library(&quot;parallel&quot;)
options(mc.cores = parallel::detectCores())
</code></pre>
<pre><code class="language-r">library(&quot;future&quot;)
library(&quot;future.apply&quot;)

chains &lt;- 3
cores &lt;- 8

future::plan(list(
  future::tweak(future::multisession, 
    workers = floor(cores/(chains + 1))),
  future::tweak(future::multisession, workers = chains)))

model &lt;- make_model(&quot;X -&gt; Y&quot;)

data &lt;- list(data_1 = data.frame(X = 0:1, Y = 0:1), 
  data_2 = data.frame(X = 0:1, Y = 1:0))

results &lt;- future.apply::future_lapply(data, function(d) {
  update_model(model = model, data = d, chains = chains, refresh = 0)},
 future.seed = TRUE)
</code></pre>
<h1 id="chp:appendix-b-stan-code">Appendix B: Stan code</h1>
<pre><code class="language-r">CausalQueries:::stanmodels$simplexes
</code></pre>
<pre><code>## S4 class stanmodel 'simplexes' coded as follows:
## functions {
##   row_vector col_sums(matrix X) {
##     row_vector[cols(X)] s;
##     s = rep_row_vector(1, rows(X)) * X;
##     return s;
##   }
## }
## data {
##   int&lt;lower=1&gt; n_params;
##   int&lt;lower=1&gt; n_paths;
##   int&lt;lower=1&gt; n_types;
##   int&lt;lower=1&gt; n_param_sets;
##   int&lt;lower=1&gt; n_nodes;
##   array[n_param_sets] int&lt;lower=1&gt; n_param_each;
##   int&lt;lower=1&gt; n_data;
##   int&lt;lower=1&gt; n_events;
##   int&lt;lower=1&gt; n_strategies;
##   int&lt;lower=0, upper=1&gt; keep_type_distribution;
##   vector&lt;lower=0&gt;[n_params] lambdas_prior;
##   array[n_param_sets] int&lt;lower=1&gt; l_starts;
##   array[n_param_sets] int&lt;lower=1&gt; l_ends;
##   array[n_nodes] int&lt;lower=1&gt; node_starts;
##   array[n_nodes] int&lt;lower=1&gt; node_ends;
##   array[n_strategies] int&lt;lower=1&gt; strategy_starts;
##   array[n_strategies] int&lt;lower=1&gt; strategy_ends;
##   matrix[n_params, n_types] P;
##   matrix[n_params, n_paths] parmap;
##   matrix[n_paths, n_data] map;
##   matrix&lt;lower=0, upper=1&gt;[n_events, n_data] E;
##   array[n_events] int&lt;lower=0&gt; Y;
## }
## parameters {
##   vector&lt;lower=0&gt;[n_params - n_param_sets] gamma;
## }
## transformed parameters {
##   vector&lt;lower=0, upper=1&gt;[n_params] lambdas;
##   vector&lt;lower=1&gt;[n_param_sets] sum_gammas;
##   matrix[n_params, n_paths] parlam;
##   matrix[n_nodes, n_paths] parlam2;
##   vector&lt;lower=0, upper=1&gt;[n_paths] w_0;
##   vector&lt;lower=0, upper=1&gt;[n_data] w;
##   vector&lt;lower=0, upper=1&gt;[n_events] w_full;
##   vector[n_param_sets] log_sum_gammas;
##   // Handle cases where parameter set has only one value
##   for (i in 1:n_param_sets) {
##     if (l_starts[i] &gt;= l_ends[i]) {
##       sum_gammas[i] = 1;
##       lambdas[l_starts[i]] = 1;
##     } else {
##       sum_gammas[i] = 1 + sum(gamma[(l_starts[i] - (i - 1)):(l_ends[i] - i)]);
##       lambdas[l_starts[i]:l_ends[i]] =
##         append_row(1, gamma[(l_starts[i] - (i - 1)):(l_ends[i] - i)]) /
##         sum_gammas[i];
##     }
##   }
##   // Mapping from parameters to data types
##   parlam = rep_matrix(lambdas, n_paths) .* parmap;
##   // Sum probability over nodes on each path
##   for (i in 1:n_nodes) {
##     parlam2[i, ] = col_sums(parlam[(node_starts[i]):(node_ends[i]), ]);
##   }
##   // Compute probability of data type on each path
##   for (i in 1:n_paths) {
##     w_0[i] = exp(sum(log(parlam2[, i])));
##   }
##   // Map to n_data columns instead of n_paths (if confounding)
##   w = map' * w_0;
##   // Extend/reduce to cover all observed data types
##   w_full = E * w;
##   // Calculate log sum gammas once for efficiency
##   log_sum_gammas = log(sum_gammas);
## }
## model {
##   // Dirichlet distributions
##   for (i in 1:n_param_sets) {
##     target += dirichlet_lpdf(lambdas[l_starts[i]:l_ends[i]] |
##                              lambdas_prior[l_starts[i]:l_ends[i]]);
##     target += -n_param_each[i] * log_sum_gammas[i];
##   }
##   // Multinomial likelihoods (handling censoring)
##   for (i in 1:n_strategies) {
##     target += multinomial_lpmf(
##       Y[strategy_starts[i]:strategy_ends[i]] |
##       w_full[strategy_starts[i]:strategy_ends[i]] /
##       sum(w_full[strategy_starts[i]:strategy_ends[i]])
##     );
##   }
## }
## // Option to export distribution of causal types
## generated quantities {
##   vector[n_types] types;
##   if (keep_type_distribution == 1) {
##     for (i in 1:n_types) {
##       types[i] = prod(P[, i] .* lambdas + 1 - P[, i]);
##     }
##   } else {
##     types = rep_vector(1, n_types);
##   }
## }
</code></pre>
<h1 id="chp:appendix-c-benchmarks">Appendix C: Benchmarks</h1>
<pre><code class="language-r">iter  &lt;- 5000
times &lt;- 5

model &lt;- list(
  CausalQueries::make_model(&quot;X -&gt; Y&quot;),
  CausalQueries::make_model(&quot;X1 -&gt; Y &lt;- X2&quot;),
  CausalQueries::make_model(&quot;X1 -&gt; Y; X2 -&gt; Y; X3 -&gt; Y&quot;)
)

data &lt;- expand_grid(X1 = 0:1, X2 = 0:1, X3 = 0:1) |&gt; uncount(20) |&gt;
  mutate(Y = 1 * (X1 - X2 * X3 + rnorm(n()) &gt; 0))


benchmark_model &lt;- microbenchmark::microbenchmark(
  m1 = CausalQueries::update_model(model[[1]], data, 
  iter = iter, refresh = 0),
  m2 = CausalQueries::update_model(model[[2]], data, 
  iter = iter, refresh = 0),
  m3 = CausalQueries::update_model(model[[3]], data, 
  iter = iter, refresh = 0),
  times = times
)

benchmark_1 &lt;- data.frame(
Model = c(
  &quot;X1 → Y&quot;,
  &quot;X1 → Y; X2 → Y&quot;,
  &quot;X1 → Y; X2 → Y; X3 → Y&quot;
  ),
  x = c(6, 20, 262),
  t = (benchmark_model |&gt; summary() |&gt; pull(mean))) 

benchmark_1 |&gt; 
 kabble(col.names = c(&quot;Model&quot;, &quot;Number of parameters&quot;, &quot;Runtime (seconds)&quot;), align = &quot;c&quot;)  
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> Model </th>
   <th style="text-align:center;"> Number of parameters </th>
   <th style="text-align:center;"> Runtime (seconds) </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> X1 → Y </td>
   <td style="text-align:center;"> 6 </td>
   <td style="text-align:center;"> 7.42 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X1 → Y; X2 → Y </td>
   <td style="text-align:center;"> 20 </td>
   <td style="text-align:center;"> 9.91 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X1 → Y; X2 → Y; X3 → Y </td>
   <td style="text-align:center;"> 262 </td>
   <td style="text-align:center;"> 94.30 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">model &lt;- CausalQueries::make_model(&quot;X -&gt; Y&quot;)

data &lt;- lapply(10^c(1:4), function(n) {
  CausalQueries::make_data(model, n)
})

benchmark_data &lt;- microbenchmark::microbenchmark(
  d0 = CausalQueries::update_model(model, data[[1]], 
    iter = iter, refresh = 0),
  d1 = CausalQueries::update_model(model, data[[2]], 
    iter = iter, refresh = 0),
  d2 = CausalQueries::update_model(model, data[[3]], 
    iter = iter, refresh = 0),
  d3 = CausalQueries::update_model(model, data[[4]], 
    iter = iter, refresh = 0),
  times = times
  )

benchmark2 &lt;- data.frame(
  Model = c(&quot;X1 → Y&quot;, 
            &quot;X1 → Y&quot;, 
            &quot;X1 → Y&quot;, 
            &quot;X1 → Y&quot;),
  x = c(10, 100,  1000, 10000),
  t = (benchmark_data |&gt; summary() |&gt; pull(mean))
) 

benchmark2 |&gt;
 kabble(col.names = c(&quot;Model&quot;, &quot;Number of observations&quot;, &quot;Runtime (seconds)&quot;), align = &quot;c&quot;)
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> Model </th>
   <th style="text-align:center;"> Number of observations </th>
   <th style="text-align:center;"> Runtime (seconds) </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> X1 → Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> 8.41 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X1 → Y </td>
   <td style="text-align:center;"> 100 </td>
   <td style="text-align:center;"> 8.34 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X1 → Y </td>
   <td style="text-align:center;"> 1000 </td>
   <td style="text-align:center;"> 11.25 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X1 → Y </td>
   <td style="text-align:center;"> 10000 </td>
   <td style="text-align:center;"> 20.48 </td>
  </tr>
</tbody>
</table>
</div>
</body>
</html>
