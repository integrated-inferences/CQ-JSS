<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Replication code for ‘Making, Updating, and Querying Causal Models using CausalQueries’</title>
<style type="text/css">
/**
 * Prism.s theme ported from highlight.js's xcode style
 */
pre code {
  padding: 1em;
}
.token.comment {
  color: #007400;
}
.token.punctuation {
  color: #999;
}
.token.tag,
.token.selector {
  color: #aa0d91;
}
.token.boolean,
.token.number,
.token.constant,
.token.symbol {
  color: #1c00cf;
}
.token.property,
.token.attr-name,
.token.string,
.token.char,
.token.builtin {
  color: #c41a16;
}
.token.inserted {
  background-color: #ccffd8;
}
.token.deleted {
  background-color: #ffebe9;
}
.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
  color: #9a6e3a;
}
.token.atrule,
.token.attr-value,
.token.keyword {
  color: #836c28;
}
.token.function,
.token.class-name {
  color: #DD4A68;
}
.token.regex,
.token.important,
.token.variable {
  color: #5c2699;
}
.token.important,
.token.bold {
  font-weight: bold;
}
.token.italic {
  font-style: italic;
}
</style>
<style type="text/css">
body {
  font-family: sans-serif;
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 1.5;
  box-sizing: border-box;
}
body, .footnotes, code { font-size: .9em; }
li li { font-size: .95em; }
*, *:before, *:after {
  box-sizing: inherit;
}
pre, img { max-width: 100%; }
pre, pre:hover {
  white-space: pre-wrap;
  word-break: break-all;
}
pre code {
  display: block;
  overflow-x: auto;
}
code { font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace; }
:not(pre) > code, code[class] { background-color: #F8F8F8; }
code.language-undefined, pre > code:not([class]) {
  background-color: inherit;
  border: 1px solid #eee;
}
table {
  margin: auto;
  border-top: 1px solid #666;
}
table thead th { border-bottom: 1px solid #ddd; }
th, td { padding: 5px; }
thead, tfoot, tr:nth-child(even) { background: #eee; }
blockquote {
  color: #666;
  margin: 0;
  padding-left: 1em;
  border-left: 0.5em solid #eee;
}
hr, .footnotes::before { border: 1px dashed #ddd; }
.frontmatter { text-align: center; }
#TOC .numbered li { list-style: none; }
#TOC .numbered { padding-left: 0; }
#TOC .numbered ul { padding-left: 1em; }
table, .body h2 { border-bottom: 1px solid #666; }
.body .appendix, .appendix ~ h2 { border-bottom-style: dashed; }
.footnote-ref a::before { content: "["; }
.footnote-ref a::after { content: "]"; }
section.footnotes::before {
  content: "";
  display: block;
  max-width: 20em;
}

@media print {
  body {
    font-size: 12pt;
    max-width: 100%;
  }
  tr, img { page-break-inside: avoid; }
}
@media only screen and (min-width: 992px) {
  pre { white-space: pre; }
}
</style>
<script>
$(document).ready(function(){
    if (typeof $('[data-toggle="tooltip"]').tooltip === 'function') {
        $('[data-toggle="tooltip"]').tooltip();
    }
    if ($('[data-toggle="popover"]').popover === 'function') {
        $('[data-toggle="popover"]').popover();
    }
});
</script>
<link href="C:\Users\humphreys\AppData\Local\Programs\R\R-4.3.0\library\kableExtra\lightable-0.0.1\lightable.css" rel="stylesheet" />
</head>
<body>
<div class="frontmatter">
<div class="title"><h1>Replication code for ‘Making, Updating, and Querying Causal Models using CausalQueries’</h1></div>
<div class="author"><h2>Till Tietz, Lily Medina, Georgiy Syunyaev, and Macartan Humphreys</h2></div>
<div class="date"><h3>December 2024</h3></div>
</div>
<div class="body">
<p>Generated by <code>knitr::spin()</code> from <code>code.R</code>.</p>
<h2 id="set-up">Set up</h2>
<pre><code class="language-r">library(tidyverse)
library(CausalQueries)
library(microbenchmark)
library(parallel)
library(future)
library(future.apply)
library(knitr)
library(rstan)

options(kableExtra.latex.load_packages = FALSE)
library(kableExtra)
options(mc.cores = parallel::detectCores())

set.seed(1, &quot;L'Ecuyer-CMRG&quot;)
theme_set(theme_bw())
</code></pre>
<h2 id="data-import">Data import</h2>
<pre><code class="language-r">data(&quot;lipids_data&quot;)

lipids_data
</code></pre>
<h2 id="lipids-model">Lipids model</h2>
<pre><code class="language-r">lipids_model &lt;-  make_model(&quot;Z -&gt; X -&gt; Y; X &lt;-&gt; Y&quot;)
</code></pre>
<pre><code class="language-r">lipids_model &lt;- update_model(lipids_model, lipids_data)
</code></pre>
<pre><code class="language-r">lipids_queries &lt;-
  query_model(
    lipids_model,
    queries = list(ATE  = &quot;Y[X=1] - Y[X=0]&quot;, 
                   PoC  = &quot;Y[X=1] - Y[X=0] :|: X==0 &amp; Y==0&quot;, 
                   LATE = &quot;Y[X=1] - Y[X=0] :|: X[Z=1] &gt; X[Z=0]&quot;),
    using = &quot;posteriors&quot;
  )
</code></pre>
<pre><code class="language-r">lipids_queries |&gt;
  dplyr::select(query, given, mean, sd, starts_with(&quot;cred&quot;)) |&gt;
  knitr::kable(
    digits = 2,
    booktabs = TRUE,
    align = &quot;c&quot;,
    escape = TRUE,
    linesep = &quot;&quot;
  )
</code></pre>
<table>
<thead>
<tr>
<th align="center">query</th>
<th align="center">given</th>
<th align="center">mean</th>
<th align="center">sd</th>
<th align="center">cred.low</th>
<th align="center">cred.high</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Y[X=1] - Y[X=0]</td>
<td align="center">-</td>
<td align="center">0.55</td>
<td align="center">0.10</td>
<td align="center">0.37</td>
<td align="center">0.73</td>
</tr>
<tr>
<td align="center">Y[X=1] - Y[X=0]</td>
<td align="center">X==0 &amp; Y==0</td>
<td align="center">0.64</td>
<td align="center">0.15</td>
<td align="center">0.37</td>
<td align="center">0.89</td>
</tr>
<tr>
<td align="center">Y[X=1] - Y[X=0]</td>
<td align="center">X[Z=1] &gt; X[Z=0]</td>
<td align="center">0.70</td>
<td align="center">0.05</td>
<td align="center">0.59</td>
<td align="center">0.80</td>
</tr>
</tbody>
</table>
<pre><code class="language-r">lipids_queries |&gt; plot()
</code></pre>
<p><img src="data:image/png;base64,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" alt="Illustration of queries plotted" /></p>
<p>All in a single pipe:</p>
<pre><code class="language-r">make_model(&quot;Z -&gt; X -&gt; Y; X &lt;-&gt; Y&quot;) |&gt;
  update_model(lipids_data) |&gt;
  query_model(
    queries = list(ATE  = &quot;Y[X=1] - Y[X=0]&quot;, 
                   PoC  = &quot;Y[X=1] - Y[X=0] :|: X==0 &amp; Y==0&quot;, 
                   LATE = &quot;Y[X=1] - Y[X=0] :|: X[Z=1] &gt; X[Z=0]&quot;),
    using = &quot;posteriors&quot;
  ) |&gt;
  plot()
</code></pre>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkAAAADYCAMAAAA07qwDAAABVlBMVEUAAAAAADoAAGYAOmYAOpAAZmYAZrYZGT8ZGWIZP4EZYp8aGhozMzM6AAA6ADo6AGY6Ojo6OpA6ZmY6ZrY6kNs/GRk/GWI/Pz8/gb1NTU1NTW5NTY5Nbm5NbqtNjo5NjshiGRliGT9iGWJiYmJin9lmAABmADpmAGZmOjpmOmZmOpBmZgBmtv9uTU1ubqtujshuq6tuq+SBPxmBvdmOTU2OTW6OTY6Obo6ObquOjk2OjsiOq+SOyP+QOgCQOjqQkDqQ2/+fYhmfYj+fYmKfn2Kf2dmrbk2rbm6r5P+2ZgC2Zjq2tma2/7a2//+9gT+9vdm92dnIjk3Ijm7Ijo7IyI7I///Zn2LZn5/ZvYHZvb3Z2Z/Z2b3Z2dnbkDrb25Db2//b///kq27kq47k/8jk///r6+v4dm3/tmb/yI7/yMj/25D/29v/5Kv//7b//8j//9v//+T///8DWhkOAAAACXBIWXMAAAsSAAALEgHS3X78AAAJeklEQVR4nO2d+1cTRxzFV7RoTa2vtBKttQ/w0aIWsWpbtLEtFmxDFQu1Siy0mtiUAPv//9LZSTaEQwIbZjZ7b3LvgWST/TJ3bvbD7GzgZIJQkhwUZN0BiVsCSHKSAJKcJIAkJ/UI0HsSo9Jhx6pXgFYkPgkgyUkCSHKSAJKcJIAkJwkgyUkCyIuef5DLjXfcszxmb3O5o9OddtBLAPnQi89mV158Ot1pl+Xk+Yez9nsAJYB8qDmamHHo6LTZXhh/8Unu2Gz8cMU8YW/iXe8+WT537Kcxu2UrM+28mwSQDy00Tl9/PokpMU+8/C1+uLLyQzQ4LY/Fu8zWcXNjt2xlpp13kwDyIUvJH7Mvb5mZUDzMHJ2OHzYBW27sepjL5Y6breUxu2UrM+6+iwSQD0Xzn5e3xs1A8zCi5KHlZSx+aOdAC8d/nLW7GjCNNQYfK+rptADyosZVmLnW+jya2ZwbX8iZmY192KAj2m9Hm3PR4JQbswDZLVuZdfcdJIAkJwkgyUkCSHKSAJKcJIAkJyEBJDEqHXasegXIfL9JVNn3KtBuIUQUQJCGPBEFEKQhT0QBBGnIE1EAQRryRBRAkIY8EQUQpCFPRAEEacgTUQBBGvJEFECQhjwRBRCkIU9EAQRpyBNRAEEa8kQUQJCGPBEFEKQhT0QBBGnIE1EAQRryRBRAkIY8EQUQpCFPRAEEacgTUQBBGvJEFECQhjwRBRCkIU9EcIAqHStpXl2iqiRFFQF0wCrQgy6AdkgAZVnFBNDbQqFwYamxvX69UJjZ7soAA1Sp+GsrhSoqgKYa30Ybd5bCja/nWl0ZXIAqlSZBAiix9gZo61Hh4usmR41PVnizWxUJSR2OUHansLWpcG1qbWb76cEegXQK6117jUBhuDgXrt+0m/8utboywACBV/EBZEegaP6z9Wim1RUBlFUVH0B2DjREV2HgVUwAdZH+lJFl1YD+KaOzaF5doioBlGYVaLcQIgogSEOeiAII0pAnogCCNOSJKIAgDXkiCiBIQ56IAgjSkCeiAII05IkogCANeSIKIEhDnogCCNKQJ6IAgjTkiSiAIA15IgogSEOeiAII0pAnogCCNOSJKIAgDXkiCiBIQ56IAgjSkCeiAII05IkogCANeSIKIEhDnogCCNKQJ6IAgjTkiSiAIA15IgogSEOeiAII0pAnogCCNOSJKIAgDXkiCiBIQ56IewJUO72aqNkuEkBEVRqB0qwC7RZCxF0AmVFn80Fx834Q5M32qzMTwWgYVoOR7ycTObRLABFVeQaoOhrWr5QMQCdL5r5+uVifEEADXeUZoNqJaOAxADUembnQvAAa6CqfAJkBx9yfCCYFUFaGPBF3A3SyVHu/WDbjz3w+BkinsH4b8kTcfRU2Hxy+WjS3wZHVGKBoEv2lABroqrQv4yOMetVQAVSB7XyXT2v3ZJgIoPpEdFHfswTQgQ0HDKADSgAd2FAAReoEUHOBsKeXwo3b0apPv5ubQvfFVjprKACqJDjuQwvQxt27S+b23uuwteKcANpZFa3v5qmtAQSosdJcO0BdVizkUdaLCe6lNHNnAtDWz3PrN143ANpegFcj0I4qncK6AxQtEnZ+TqewPlUNHkBPZ+yGAOpP1WABZE5ZH99Zsgt+x6ewwlSrK6DHALRbCBH1PhCkIU9EAQRpyBOxG0D7XQP81/pv6WrXP3IIIKIqzwBF7x7s1VD9iwT/bi+AiKo8ArTjPaj4yeqZEyOlzfvBkdX6RDBSKgej5v7IavXUyC95+7TZ+jXa09aQACKqSvsUVjWI5Mv5sJwvT4abf5kRyNxX89XRsPm02bJ72n5GABFVpT2JNjOd2tnHRXNjRp5DRQPQfBAEo+bpat4+bbbsnrafEUBEVakD1Bpqogf5xghkuYpHIDuX3jGjFkBEVakDdCpozoHKgd0atf9lZgFqzIEMRYHmQLRVfTiF9SwBRFQlgNKsAu0WQkS9Ew1pyBNRAEEa8kQUQJCGPBEFEKQhT0QBBGnIE1EAQRryRBRAkIY8EQUQpCFPRAEEacgTUQBBGvJEFECQhjwRBRCkIU9EAQRpyBNRAEEa8kQUQJCGPBEFEKQhT0QBBGnIE1EAQRryRBRAkIY8EQUQpCFPRAEEacgTUQBBGvJEFECQhjwRBRCkIU9EAQRpyBNRAEEa8kQUQJCGPBEFEKQhT0RwgDp/UCPNq5tGVSVRVc+OAijNKgHUtUoA9bkpAZRcewCUdME5IID2Xz1HAHlWd4ASLziHA9B+n5zt11AAReoOUOIF5zJYnQ1eaS4f17syASj5gnM4I5BOYZ2rMgEo+YJzQAChVAmgXhacE0C7JICiteaSLjgngHZJAHWT/pSRZZUASrMKtFsIEQUQpCFPRAEEacgTUQBBGvJEFECQhjwRBRCkIU9EAQRpyBNRAEEa8kQUQJCGPBEFEKQhT0QBBGnIE1EAQRryRBRAkIY8EQUQpCFPRAEEacgTUQBBGvJEFECQhjwRBRCkIU9EAQRpyBNRAEEa8kQUQJCGPBEFEKQhT0QBBGnIExEJIIlR6bBj1SNAyeWz0x7bAu0WasT9JYAGrq0BAUgaDgkgyUkCSHKSAJKc5B+grUeFS42t6CPy/LRl7s/PeWvqoq9urbU+NwmiX3FTG7fjI9AH+Qfo7ZT9dLMoj/ORitva+NZbt9Zmoi8/bRk9W/LUlrl37VdbxLeuERPLP0B/zzU/E2/tq3uuAMVtrV93/vWMm3r2jfsI1IrY/ul/jm15AChuKgKob0OQf4AW44N+4x9ngBa3X9317/w0ZX5HnY/6Ygsg5wFou60157Nh3JQ5hX1007GtxEpvBPIxQdj+VXc+6q0RaMkdoFa31t2PU+vlmoq+vDQV+hgZkyrFOZD9hFc/bXk4q/ucILQiejhO7f1yPO+0NfWUeA5krwUsO+4AxW1tX9n5aMrPVViUznk6vt2WOe9ccDwfeny1kkvvA0lOEkCSkwSQ5CQBJDlJAElOEkCSkwRQU7XTq1l3gVICqCkBdDANNUDlvP0uB8GoAejV6dXNB8WwGj2SkmqoAapZZMxt/UopBigaieYns+4Zj4YaoPBxsXbWcHQiOFSMATIDUBDks+4Yj4YboOqoGWyqI6X65QZA5r6q81dPGm6A6teulQxFYdWOQCdLtfeL5mvzvk5hiTXcAIXzZrypTwTvTEyauc98cPiqJtE9asgBklwlgCQnCSDJSQJIcpIAkpwkgCQnCSDJSf8D/NrkR89hM3cAAAAASUVORK5CYII=" alt="plot of chunk unnamed-chunk-9" /></p>
<h2 id="making-models">Making models</h2>
<pre><code class="language-r">with_pars &lt;-
  lipids_model |&gt;
  set_parameters(param_type = &quot;prior_draw&quot;)

with_pars |&gt; grab(&quot;parameters_df&quot;) |&gt;
  dplyr::select(node, nodal_type, param_set, 
                param_names, param_value, priors) |&gt;
  knitr::kable(
    digits = 2,
    booktabs = TRUE,
    align = &quot;c&quot;,
    escape = TRUE,
    longtable = TRUE,
    linesep = &quot;&quot;
  ) |&gt;
  kableExtra::kable_classic_2(latex_options = c(&quot;hold_position&quot;))
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> node </th>
   <th style="text-align:center;"> nodal_type </th>
   <th style="text-align:center;"> param_set </th>
   <th style="text-align:center;"> param_names </th>
   <th style="text-align:center;"> param_value </th>
   <th style="text-align:center;"> priors </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> Z </td>
   <td style="text-align:center;"> 0 </td>
   <td style="text-align:center;"> Z </td>
   <td style="text-align:center;"> Z.0 </td>
   <td style="text-align:center;"> 0.84 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Z </td>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> Z </td>
   <td style="text-align:center;"> Z.1 </td>
   <td style="text-align:center;"> 0.16 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> X.00 </td>
   <td style="text-align:center;"> 0.12 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> X.10 </td>
   <td style="text-align:center;"> 0.08 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> X.01 </td>
   <td style="text-align:center;"> 0.11 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> X </td>
   <td style="text-align:center;"> X.11 </td>
   <td style="text-align:center;"> 0.69 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> Y.X.00 </td>
   <td style="text-align:center;"> Y.00_X.00 </td>
   <td style="text-align:center;"> 0.38 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> Y.X.00 </td>
   <td style="text-align:center;"> Y.10_X.00 </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> Y.X.00 </td>
   <td style="text-align:center;"> Y.01_X.00 </td>
   <td style="text-align:center;"> 0.20 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> Y.X.00 </td>
   <td style="text-align:center;"> Y.11_X.00 </td>
   <td style="text-align:center;"> 0.42 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> Y.X.01 </td>
   <td style="text-align:center;"> Y.00_X.01 </td>
   <td style="text-align:center;"> 0.40 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> Y.X.01 </td>
   <td style="text-align:center;"> Y.10_X.01 </td>
   <td style="text-align:center;"> 0.38 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> Y.X.01 </td>
   <td style="text-align:center;"> Y.01_X.01 </td>
   <td style="text-align:center;"> 0.06 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> Y.X.01 </td>
   <td style="text-align:center;"> Y.11_X.01 </td>
   <td style="text-align:center;"> 0.16 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> Y.X.10 </td>
   <td style="text-align:center;"> Y.00_X.10 </td>
   <td style="text-align:center;"> 0.71 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> Y.X.10 </td>
   <td style="text-align:center;"> Y.10_X.10 </td>
   <td style="text-align:center;"> 0.15 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> Y.X.10 </td>
   <td style="text-align:center;"> Y.01_X.10 </td>
   <td style="text-align:center;"> 0.05 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> Y.X.10 </td>
   <td style="text-align:center;"> Y.11_X.10 </td>
   <td style="text-align:center;"> 0.09 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 00 </td>
   <td style="text-align:center;"> Y.X.11 </td>
   <td style="text-align:center;"> Y.00_X.11 </td>
   <td style="text-align:center;"> 0.65 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> Y.X.11 </td>
   <td style="text-align:center;"> Y.10_X.11 </td>
   <td style="text-align:center;"> 0.04 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 01 </td>
   <td style="text-align:center;"> Y.X.11 </td>
   <td style="text-align:center;"> Y.01_X.11 </td>
   <td style="text-align:center;"> 0.01 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> Y </td>
   <td style="text-align:center;"> 11 </td>
   <td style="text-align:center;"> Y.X.11 </td>
   <td style="text-align:center;"> Y.11_X.11 </td>
   <td style="text-align:center;"> 0.30 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">model &lt;- make_model(&quot;X -&gt; M -&gt; Y &lt;- X&quot;)
</code></pre>
<pre><code class="language-r">lipids_model |&gt; plot()

lipids_model |&gt;
  plot(
    x_coord = 1:3,
    y_coord = 3:1,
    textcol = &quot;black&quot;,
    textsize = 3,
    shape = c(15, 16, 16),
    nodecol = &quot;lightgrey&quot;,
    nodesize = 10
  )
</code></pre>
<div class="figure">
<img src="data:image/png;base64,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" alt="Examples of model graphs." width="50%" /><img src="data:image/png;base64,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" alt="Examples of model graphs." width="50%" />
<p class="caption">Examples of model graphs.</p>
</div>
<pre><code class="language-r">statements &lt;- list(
  &quot;X -&gt; Y &lt;- W&quot;,
  &quot;X -&gt; Y &lt;- W; X &lt;-&gt; W&quot;,
  &quot;X -&gt; Y &lt;- W; X &lt;-&gt; Y; W &lt;-&gt; Y&quot;,
  &quot;X -&gt; Y &lt;- W; X &lt;-&gt; Y; W &lt;-&gt; Y; X &lt;-&gt; W&quot;,
  &quot;X -&gt; W -&gt; Y &lt;- X&quot;,
  &quot;X -&gt; W -&gt; Y &lt;- X; W &lt;-&gt; Y&quot;,
  &quot;X -&gt; W -&gt; Y &lt;- X; X &lt;-&gt; W; W &lt;-&gt; Y&quot;,
  &quot;X -&gt; W -&gt; Y &lt;- X; X &lt;-&gt; W; W &lt;-&gt; Y; X &lt;-&gt; Y&quot;
)

dof &lt;- function(statement) {
  make_model(statement, add_causal_types = FALSE) |&gt;
    grab(&quot;parameters_df&quot;)  |&gt;
    group_by(param_set) |&gt;
    summarize(n  = n() - 1) |&gt;
    pull(n) |&gt;
    sum()
}


statements |&gt;
  lapply(function(s)
    paste0(&quot;`&quot;, s, &quot;`&quot;)) |&gt;
  unlist() |&gt;
  data.frame(Model = _, dof = unlist(lapply(statements, dof))) |&gt;
  knitr::kable(
    digits = 2,
    booktabs = TRUE,
    align = c(&quot;l&quot;, &quot;c&quot;),
    escape = TRUE,
    linesep = &quot;&quot;,
    col.names = c(&quot;Model&quot;, &quot;Degrees of freedom&quot;)
  )
</code></pre>
<table>
<thead>
<tr>
<th align="left">Model</th>
<th align="center">Degrees of freedom</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>X -&gt; Y &lt;- W</code></td>
<td align="center">17</td>
</tr>
<tr>
<td align="left"><code>X -&gt; Y &lt;- W; X &lt;-&gt; W</code></td>
<td align="center">18</td>
</tr>
<tr>
<td align="left"><code>X -&gt; Y &lt;- W; X &lt;-&gt; Y; W &lt;-&gt; Y</code></td>
<td align="center">62</td>
</tr>
<tr>
<td align="left"><code>X -&gt; Y &lt;- W; X &lt;-&gt; Y; W &lt;-&gt; Y; X &lt;-&gt; W</code></td>
<td align="center">63</td>
</tr>
<tr>
<td align="left"><code>X -&gt; W -&gt; Y &lt;- X</code></td>
<td align="center">19</td>
</tr>
<tr>
<td align="left"><code>X -&gt; W -&gt; Y &lt;- X; W &lt;-&gt; Y</code></td>
<td align="center">64</td>
</tr>
<tr>
<td align="left"><code>X -&gt; W -&gt; Y &lt;- X; X &lt;-&gt; W; W &lt;-&gt; Y</code></td>
<td align="center">67</td>
</tr>
<tr>
<td align="left"><code>X -&gt; W -&gt; Y &lt;- X; X &lt;-&gt; W; W &lt;-&gt; Y; X &lt;-&gt; Y</code></td>
<td align="center">127</td>
</tr>
</tbody>
</table>
<h2 id="tailoring-models">Tailoring models</h2>
<pre><code class="language-r">model_restricted &lt;-
  lipids_model |&gt;
  set_restrictions(&quot;X[Z=1] &lt; X[Z=0]&quot;)
</code></pre>
<pre><code class="language-r">model &lt;-
  lipids_model |&gt;
  set_restrictions(labels = list(X = &quot;01&quot;, 
                                 Y = c(&quot;00&quot;, &quot;01&quot;, &quot;11&quot;)), keep = TRUE)
</code></pre>
<pre><code class="language-r">model &lt;- lipids_model |&gt;
  set_restrictions(labels = list(Y = &quot;?0&quot;))
</code></pre>
<pre><code class="language-r">model &lt;- lipids_model |&gt;
  set_restrictions(labels = list(Y = c('00', '11')), given = 'X.00')
</code></pre>
<pre><code class="language-r">lipids_model |&gt;
  inspect(&quot;prior_hyperparameters&quot;, nodes = &quot;X&quot;)
</code></pre>
<pre><code>## 
## prior_hyperparameters
## Alpha parameter values used for Dirichlet prior distributions:
## 
## X.00 X.10 X.01 X.11 
##    1    1    1    1
</code></pre>
<pre><code class="language-r">model &lt;- lipids_model |&gt;
  set_priors(distribution = &quot;jeffreys&quot;)
</code></pre>
<pre><code>## Altering all parameters.
</code></pre>
<pre><code class="language-r">lipids_model |&gt;
  set_priors(param_names = c(&quot;X.10&quot;, &quot;X.01&quot;), alphas = 3:4) |&gt;
  inspect(&quot;prior_hyperparameters&quot;, nodes = &quot;X&quot;)
</code></pre>
<pre><code>## 
## prior_hyperparameters
## Alpha parameter values used for Dirichlet prior distributions:
## 
## X.00 X.10 X.01 X.11 
##    1    3    4    1
</code></pre>
<pre><code class="language-r">lipids_model |&gt;
  set_priors(statement = &quot;X[Z=1] &gt; X[Z=0]&quot;, alphas = 3) |&gt;
  inspect(&quot;prior_hyperparameters&quot;, nodes = &quot;X&quot;)
</code></pre>
<pre><code>## 
## prior_hyperparameters
## Alpha parameter values used for Dirichlet prior distributions:
## 
## X.00 X.10 X.01 X.11 
##    1    1    3    1
</code></pre>
<pre><code class="language-r">query &lt;-
  make_model(&quot;X -&gt; Y&quot;) |&gt;
  set_restrictions(decreasing(&quot;X&quot;, &quot;Y&quot;)) |&gt;
  query_model(&quot;Y[X=1] - Y[X=0]&quot;, using = &quot;priors&quot;)
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt;
  inspect(&quot;parameters&quot;)
</code></pre>
<pre><code>## 
## parameters
## Model parameters with associated probabilities: 
## 
##  X.0  X.1 Y.00 Y.10 Y.01 Y.11 
## 0.50 0.50 0.25 0.25 0.25 0.25
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt;
  set_parameters(statement = &quot;Y[X=1] &gt; Y[X=0]&quot;, parameters = .7) |&gt;
  inspect(&quot;parameters&quot;)
</code></pre>
<pre><code>## 
## parameters
## Model parameters with associated probabilities: 
## 
##  X.0  X.1 Y.00 Y.10 Y.01 Y.11 
##  0.5  0.5  0.1  0.1  0.7  0.1
</code></pre>
<h2 id="drawing-data-from-a-model">Drawing data from a model</h2>
<p>Complete data</p>
<pre><code class="language-r">lipids_model |&gt;
  make_data(n = 4)
</code></pre>
<p>Incomplete data</p>
<pre><code class="language-r">sample_data &lt;-
  lipids_model |&gt;
  make_data(
    n = 8,
    nodes = list(c(&quot;Z&quot;, &quot;Y&quot;), &quot;X&quot;),
    probs = list(1, .5),
    subsets = list(TRUE, &quot;Z==1 &amp; Y==0&quot;)
  )
</code></pre>
<p>Data in compact form</p>
<pre><code class="language-r">sample_data |&gt;
  collapse_data(lipids_model)
</code></pre>
<h2 id="updating-models">Updating models</h2>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt;
  inspect(&quot;parameter_mapping&quot;)
</code></pre>
<pre><code>## 
## parameter_mapping (Parameter mapping matrix) 
## 
##   Maps from parameters to data types, with
##   possibly multiple columns for each data type
##   in cases with confounding. 
## 
##      X0Y0 X1Y0 X0Y1 X1Y1
## X.0     1    0    1    0
## X.1     0    1    0    1
## Y.00    1    1    0    0
## Y.10    0    1    1    0
## Y.01    1    0    0    1
## Y.11    0    0    1    1
</code></pre>
<pre><code class="language-r">data &lt;- data.frame(X = rep(0:1, 5), Y = rep(0:1, 5))

list(
  uncensored =
    update_model(make_model(&quot;X -&gt; Y&quot;), data),
  censored =
    update_model(make_model(&quot;X -&gt; Y&quot;), data, censored_types = c(&quot;X1Y0&quot;, &quot;X0Y1&quot;))
) |&gt;
  query_model(&quot;Y[X=1] - Y[X=0]&quot;, using = &quot;posteriors&quot;)
</code></pre>
<pre><code>## 
## Causal queries generated by query_model (all at population level)
</code></pre>
<pre><code class="language-r">model &lt;-
  make_model(&quot;X -&gt; Y&quot;)  |&gt;
  update_model()
</code></pre>
<pre><code>## No data provided
</code></pre>
<pre><code class="language-r">posterior &lt;- inspect(model, &quot;posterior_distribution&quot;)
</code></pre>
<pre><code>## 
## posterior_distribution
## Summary statistics of model parameters posterior distributions:
## 
##   Distributions matrix dimensions are 
##   4000 rows (draws) by 6 cols (parameters)
## 
##      mean   sd
## X.0  0.51 0.28
## X.1  0.49 0.28
## Y.00 0.25 0.19
## Y.10 0.25 0.19
## Y.01 0.25 0.19
## Y.11 0.25 0.20
</code></pre>
<pre><code class="language-r">lipids_model &lt;-
  lipids_model |&gt;
  update_model(keep_fit = TRUE, keep_event_probabilities = TRUE)
</code></pre>
<pre><code>## No data provided
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;)  |&gt;
  update_model(keep_type_distribution = FALSE) |&gt;
  inspect(&quot;stan_summary&quot;)
</code></pre>
<pre><code>## No data provided
</code></pre>
<pre><code>## 
## stan_summary
## Stan model summary:
## 
## Inference for Stan model: simplexes.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##             mean se_mean   sd   2.5%   25%   50%   75% 97.5% n_eff Rhat
## X.0         0.50    0.01 0.29   0.03  0.25  0.49  0.74  0.97  3036    1
## X.1         0.50    0.01 0.29   0.03  0.26  0.51  0.75  0.97  3036    1
## Y.00        0.25    0.00 0.19   0.01  0.09  0.21  0.37  0.70  2031    1
## Y.10        0.25    0.00 0.19   0.01  0.09  0.21  0.37  0.71  4633    1
## Y.01        0.25    0.00 0.20   0.01  0.09  0.20  0.37  0.72  4162    1
## Y.11        0.25    0.00 0.20   0.01  0.09  0.20  0.37  0.71  4701    1
## lp__       -7.53    0.04 1.65 -11.75 -8.37 -7.15 -6.32 -5.44  1368    1
## 
## Samples were drawn using NUTS(diag_e) at Fri Dec 20 11:32:28 2024.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).
</code></pre>
<p>Preservation of warnings after updating</p>
<pre><code class="language-r">model &lt;-
  make_model(&quot;X -&gt; M -&gt; Y&quot;) |&gt;
  update_model(data = data.frame(X = rep(0:1, 10000), Y = rep(0:1, 10000)),
               iter = 5000,
               refresh = 0)
</code></pre>
<pre><code>## Warning: The largest R-hat is 1.73, indicating chains have not mixed.
## Running the chains for more iterations may help. See
## https://mc-stan.org/misc/warnings.html#r-hat
</code></pre>
<pre><code>## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
## Running the chains for more iterations may help. See
## https://mc-stan.org/misc/warnings.html#bulk-ess
</code></pre>
<pre><code>## Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
## Running the chains for more iterations may help. See
## https://mc-stan.org/misc/warnings.html#tail-ess
</code></pre>
<pre><code class="language-r">model
</code></pre>
<pre><code>## 
## Causal statement: 
## M -&gt; Y; X -&gt; M
## 
## Number of nodal types by node:
## X M Y 
## 2 4 4 
## 
## Number of causal types: 32
## 
## Model has been updated and contains a posterior distribution with
## 4 chains, each with iter=5000; warmup=2500; thin=1;  
## Use inspect(model, 'stan_objects') to inspect stan summary
## 
## Warnings passed from rstan during updating:
## The largest R-hat is 1.73, indicating chains have not mixed
## Bulk Effective Samples Size (ESS) is too low
## Tail Effective Samples Size (ESS) is too low
</code></pre>
<p>Preservation of entire stanfit object</p>
<h2 id="section">––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––</h2>
<pre><code class="language-r">model &lt;-
  make_model(&quot;X -&gt; Y&quot;) |&gt;
  update_model(refresh = 0, keep_fit = TRUE)
</code></pre>
<pre><code>## No data provided
</code></pre>
<pre><code class="language-r">model |&gt;
  inspect(&quot;stanfit&quot;)
</code></pre>
<pre><code>## 
## stanfit
## Stan model summary:
## Inference for Stan model: simplexes.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##             mean se_mean   sd   2.5%   25%   50%   75% 97.5% n_eff Rhat
## lambdas[1]  0.50    0.01 0.29   0.03  0.25  0.50  0.75  0.97  2558    1
## lambdas[2]  0.50    0.01 0.29   0.03  0.25  0.50  0.75  0.97  2558    1
## lambdas[3]  0.25    0.00 0.20   0.01  0.09  0.20  0.37  0.71  2012    1
## lambdas[4]  0.26    0.00 0.20   0.01  0.10  0.21  0.38  0.72  4663    1
## lambdas[5]  0.25    0.00 0.20   0.01  0.08  0.20  0.37  0.71  4851    1
## lambdas[6]  0.25    0.00 0.19   0.01  0.09  0.20  0.36  0.71  4266    1
## types[1]    0.13    0.00 0.14   0.00  0.03  0.08  0.18  0.49  2317    1
## types[2]    0.12    0.00 0.13   0.00  0.02  0.07  0.18  0.49  2150    1
## types[3]    0.13    0.00 0.14   0.00  0.03  0.08  0.18  0.51  3350    1
## types[4]    0.13    0.00 0.13   0.00  0.03  0.08  0.18  0.50  3460    1
## types[5]    0.12    0.00 0.13   0.00  0.03  0.08  0.18  0.49  3676    1
## types[6]    0.12    0.00 0.14   0.00  0.02  0.08  0.18  0.51  3694    1
## types[7]    0.12    0.00 0.13   0.00  0.03  0.08  0.18  0.47  3424    1
## types[8]    0.12    0.00 0.13   0.00  0.03  0.08  0.18  0.49  3166    1
## lp__       -7.55    0.05 1.66 -11.87 -8.39 -7.15 -6.33 -5.45  1357    1
## 
## Samples were drawn using NUTS(diag_e) at Fri Dec 20 11:32:40 2024.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).
</code></pre>
<h2 id="querying-models">Querying models</h2>
<p>Finding outcomes consistent with interventions</p>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt;
  realise_outcomes()
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt;
  realise_outcomes(dos = list(X = 1))
</code></pre>
<p>Finding types consistent with a query</p>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;)  |&gt;
  get_query_types(&quot;Y==1&quot;)
</code></pre>
<pre><code>## 
## Causal types satisfying query's condition(s)  
## 
##  query =  Y==1 
## 
## X0.Y10  X1.Y01
## X0.Y11  X1.Y11
## 
## 
##  Number of causal types that meet condition(s) =  4
##  Total number of causal types in model =  8
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;)  |&gt;
  get_query_types(&quot;Y[X=1]==1&quot;)
</code></pre>
<pre><code>## 
## Causal types satisfying query's condition(s)  
## 
##  query =  Y[X=1]==1 
## 
## X0.Y01  X1.Y01
## X0.Y11  X1.Y11
## 
## 
##  Number of causal types that meet condition(s) =  4
##  Total number of causal types in model =  8
</code></pre>
<pre><code class="language-r">make_model(&quot;X1 -&gt; Y &lt;- X2&quot;)  |&gt;
  get_query_types(&quot;X1==1 &amp; X2==1 &amp; (Y[X1=1, X2=1] &gt; Y[X1=0, X2=0])&quot;)
</code></pre>
<pre><code>## 
## Causal types satisfying query's condition(s)  
## 
##  query =  X1==1&amp;X2==1&amp;(Y[X1=1,X2=1]&gt;Y[X1=0,X2=0]) 
## 
## X11.X21.Y0001  X11.X21.Y0101
## X11.X21.Y0011  X11.X21.Y0111
## 
## 
##  Number of causal types that meet condition(s) =  4
##  Total number of causal types in model =  64
</code></pre>
<pre><code class="language-r">make_model(&quot;X -&gt; Y&quot;) |&gt;
  get_query_types(&quot;Y[X=1] - Y[X=0]&quot;)
</code></pre>
<pre><code>## X0.Y00 X1.Y00 X0.Y10 X1.Y10 X0.Y01 X1.Y01 X0.Y11 X1.Y11 
##      0      0     -1     -1      1      1      0      0
</code></pre>
<p>Querying directly from posteriors over model parameters</p>
<pre><code class="language-r">data  &lt;- data.frame(X = rep(0:1, 50), Y = rep(0:1, 50))

model &lt;-
  make_model(&quot;X -&gt; Y&quot;) |&gt;
  update_model(data, iter  = 4000, refresh = 0)

model |&gt;
  inspect(&quot;posterior_distribution&quot;)  |&gt;
  ggplot(aes(Y.01 - Y.10)) + geom_histogram()
</code></pre>
<pre><code>## 
## posterior_distribution
## Summary statistics of model parameters posterior distributions:
## 
##   Distributions matrix dimensions are 
##   8000 rows (draws) by 6 cols (parameters)
## 
##      mean   sd
## X.0  0.50 0.05
## X.1  0.50 0.05
## Y.00 0.02 0.02
## Y.10 0.01 0.01
## Y.01 0.95 0.03
## Y.11 0.02 0.02
</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</code></pre>
<div class="figure" style="text-align: center">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfgAAAH4CAMAAACR9g9NAAAAq1BMVEUAAAAAAGYAOpAAZrYzMzM6ADo6AGY6OpA6kNtNTU1NTY5Nbm5NbqtNjshZWVlmAABmADpmAGZmOpBmtv9ujshuq+SOTU2ObquOjk2OyP+QOgCQOjqQOmaQ2/+rbk2rbo6r5P+2ZgC2Zjq2/7a2///Ijk3Ijm7Ijo7IyP/I///bkDrb///kq27kq47k///r6+v/tmb/yI7/25D/5Kv//7b//8j//9v//+T///+DjvxaAAAACXBIWXMAAAsSAAALEgHS3X78AAAOyklEQVR4nO2dgXIUxxFA5dixUQy2CRaJcMCQgAhGwhYRsP//ZVnpdNKAW7c9sz3dvbfvFXXgUtejZ5/27lRGpYMBVslB9AIQA+FXCuFXCuFXijb8N7A31IXf8bHflY5dWDj2a5FupyF8N0ceCeFdHXkkhHd15JEQ3tWRR0J4V0ceCeFdHXkkhHd15JEQ3tWRR0J4V0ceCeFdHXkkhHd15JEQ3tWRR0J4V0ceCeFdHXkkhHd15JEQ3tWRR0J4V0ceCeFdHXkkhHd15JEQ3tVhLvnhM2YuQvhuDsLrSXO90yxCeF9JmkUI7ytJswjhfSVpFiG8ryTNIoT3laRZhPC+kjSLEN5XkmYRwvtK0ixCeF9JmkUI7ytJswjhfSVpFiG8ryTLIj/czcxFCN/NQXg9Wa53mkUI7yzJsgjhnSVZFiG8syTLIoR3lmRZhPDOkiyLEN5ZkmURwjtLsixCeGdJlkUI7yzJsgjhnSVZFiG8syTLIoR3lmRZhPDOkiyLEN5ZkmURwjtLsixCeGdJlkXShP8dXNkRfqaZO76bY6/u+Ep7LVmud5pFCO8sybII4Z0lWRYhvLMkyyKEd5ZkWYTwzpIsixDeWZJlEcI7S7IsQnhnSZZFCO8sybII4Z0lWRYhvLMkyyKEd5ZkWYTwzpIsixDeWZJlEcI7S7IsQnhnSZZFCO8sybII4Z0lWRYhvLMkyyKEd5ZkWYTwzpIsixDeWRK3yI7UhO8vIbw0rbfXQnjCx0oIL03r7bUQnvCxEsJL03p7LYQnfKxkAeErPg0I7+ogvB7CEz5WQnhpWm+vhfCEj5UQXprW22shPOFjJYSXpvX2WghP+FgJ4aVpvb0WwhM+VkJ4aVpvr4XwhI+VEF6a1ttrITzhYyWEl6b19loIT/hYCeGlab29FsITPlZCeGlab6+F8ISPlRBemtbbayF8gvAfHh8+GD492z4U03p7LYRPEP70eDg/Pj8aXm0eimm9vRbCJwn/4Oz5cH509TCOjpj8MDXYQWP46r9n51P99z+fXDY/2YQfuOMdJPF3/Mj1zX5GeD9JfPjxqf4Vr/Hukvjwt2/oeVfvKIkPL0H47hLCh0oIL03r7bUQnvCxEsJL03p7LYQnfKyE8NK03l4L4QkfKyG8NK2310J4wsdKCC9N6+21EJ7wsRLCS9N6ey2EJ3yshPDStN5eC+EJHyshvDStt9eyyvCNqQnfQ0J4aVpvr4XwhI+VEF6a1ttrITzhYyWEl6b19loIT/hYCeGlab29FsITPlZCeGlab6+F8ISPlRBemtbbayE84WMlhJem9fZaCE/4WAnhpWm9vRbCEz5WQnhpWm+vhfCEj5UQXprW22shPOFjJYSXpvX2WghP+FgJ4aVpvb0WwhM+VkJ4aVpvr4XwhI+VEF6a1ttrITzhYyWEl6b19loIT/hYCeGlab29FsITPlZCeGlab6+F8FnDd/hBa6vHJHz138od382xV3d8pb0WwhM+VkJ4aVpvr4XwhI+VEF6a1ttrITzhYyWEl6b19loIT/hYCeGlab29FsITPlZCeGlab6+F8ISPlRBemtbbayE84WMlhJem9fZaCE/4WAnhpWm9vRbCEz5WQnhpWm+vhfCEj5UQXprW22shPOFjJYSXpvX2WghP+FgJ4aVpvb0WwhM+VkJ4aVpvr4XwhI+VEF6a1ttrITzhYyWEl6b19loIT/hYCeGlab29FsITPlZCeGlab6+F8ISPlRBemtbbayE84WMlhJem9fZaCE/4WAnhpWm9vRbC26BYhPDdHITXQ3jCx0oIL03LLO16d3cQXg/hCR8rIbw0LbO0693dQXg9hCd8rITw0rTM0q53d8dSw396dnj/3fjwYLh6KKZnHXMnhI8Kf/Hw5fXDcHo8/jo/Gl5tHorpWcfcCeFjwn98cnDFX96O//H6n+Mdf/Z8OD+6ehhHRzr89K3V0yG84m+V7vgN401+fnTyfPtQfJrM+vzeCXe8DYpFvnyN/+3yjv/qsv7rN9ub/YzwPSUpwl/89HT7x/E1/pzXeAdJjvC3T/W8q3eSpAg/vHi0a0fCm0g6pJ4b/uLHm9d4CcKbSBKGn4DwJpKE4bnj7RyLCn/FH/fu2pjwJpKs4Yu39uJ05TErIHxo+PffEt7Asajwm9d4nupXF34CwptIMoa/vOXvfFNPeBtJwvAfnzwa39Vf/W9ZCcKbSBKGL/4hhgThTSQJw3PH2zkWFZ7XeDvHssLvhvAmkozhx6f59399KgwW05XHrIDwUeE//jJGf/8dr/EGjkWF5129nWNR4XlXb+dYVHje1ds5lhV+N4Q3kRC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+h2MBixC+hyPlIt1TEz7nIoTfDeEJHyshvDQ9ecxmCE/4WAnhpenJYzZDeMLHSggvTU8esxnCZw3f/Yew7SnO4RUbccd3c+zVHa87ZjOEJ3yshPDS9OQxmyE84WMlhJemJ4/ZDOEJHyshvDQ9ecxmCE/4WAnhpenJYzZDeMLHSggvTU8esxnCEz5WQnhpevKYzRCe8LESwkvTk8dshvCEj5UQXpqePGYzhCd8rITw0vTkMZshPOFjJYSXpieP2QzhCR8rIbw0PXnMZghP+FgJ4aXpyWM2Q3jCx0oIL01PHrMZwhM+VkJ4aXrymM0QnvCxEsJL05PHbIbwhI+VEF6anjxmM4QnfKyE8NL05DGbITzhYyWEl6Ynj9nMHoV3Tk34LIsQvgbCEz5WQnhpWibH9TaSEF6alslxvY0khJemZXJcbyMJ4aVpmRzX20hCeGlaJsf1NpIQXpqWyXG9jSSEl6ZlclxvIwnhpWmZHNfbSEJ4aVomx/U2khBempbJcb2NJISXpmVyXG8jyZrDf3p2+KB4KKZlclxvI8maw58fDSfPx4dXx1cPxbRMjuttJFlz+PGe//XN2fPxE+DqYRwd6f5zuvaG0PCK/XaE//D4wXjPj81PNuEH7vgKQsMrTrPzzd31zX5G+HqWG/70eMzNa3wryw0/vpe//4539a0sN7wE4dUQvgbCEz5WQnhpWibH9TaSEF6alslxvY0khJemZXJcbyMJ4aVpmRzX20hCeGlaJsf1NpIQXpqWyXG9jSSEl6ZlclxvIwnhpWmZHNfbSEJ4aVomx/U2krQ4QlN/juI0hDdzRNcuUJyG8GaO6NoFitMQ3swRXbtAcRrCmzmiaxcoTkN4M0d07QLFaQhv5oiuXaA4DeHNHNG1CxSnIbyZI7p2geI0hDdzRNcuUJyG8GaO6NoFitMQ3swRXbtAcRrCmzmiaxcoTkN4M0d07QLFaQhv5oiuXaA4DeHNHNG1CxSnIbyZI7p2geI0hDdzRNcuUJyG8GaO6NoFitMQ3swRXbtAcRrCmzmiaxcoTkN4M0d07QLFaQhv5oiuXaA4DeHNHNG1CxSnIbyZI7p2geI0hDdzRNcuUJyG8GaO6NoFitMQ3swRXbtAcRrCmzmiaxcoTkN4M0d07QLFaQhv5oiuXaA4DeHNHNG1CxSnIbyZI7p2geI0hDdzRNcuUJyG8GaO6NoFitMQ3swRXbtAcRrCz3BE970TxWkIP8MR3fdOFKch/AxHdN87UZyG8DMc0X3vRHGayvDdf1zboojuq0TcnTt+hiO6qBKe6q0d0UWVEN7aEV1UCeGtHdFFlRDe2hFdVAnhrR3RRZUQfr4jumEThJ/viG7YBOHnO6IbNkH4+Y7ohk0Qfr4jumEThJ/viG7YBOHnO6IbNkH4+Y7ohk0Qfr4jumEThJ/viG7YBOHnO6IbNkH4+Y7ohk0Qfr4jumEThJ/viG7YBOHnO6IbNkH4+Y7ohk0Qfr4jumEThJ/viG7YBOHnO6IbNkH4+Y7ohk0Qfr4jumEThJ/viG7YBOHnO6IbNkH4Fkd0NQMI3+KIrmYA4Vsc0dUMIHyLI7qaAYRvcURXM4DwOqI7mUN4HdGdzCG8juhO5hBeR3QncwivI7qTOYTXEd3JHMLriO5kDuF1RHcyh/A6ojuZQ/i7iC7TGcLfEt3CFcLfEt3CFcLfEt3ClZWHj778cRB+pRB+pRB+pawufPQFz0Jz+E/PDh+U0xPXewb1b8h3fQw2NIc/PxpeHRfT7dGm4CuxHjSHP3t+2X74ZsT553tBNzThTzbhhxx3vIskzSLdTlNxxw+EX6hkP17jXSRpFgkNn+tdvYskzSKh4b+c1ttrSX2plishvKsjj4Twro48EsK7OvJICO/qyCMhvKsjj4Twro48EsK7OvJICO/qyCMhvKsjj4Twro48EsK7OvJICO/qyCMhvKsjj4Twro48EsK7OvJIDMLD3lAVfucnhYHDBBb5krsXIXwPFrCIRXhYIIRfKYRfKYRfKbPCb//Z/enh4eGRzT7zFhl/v/8uwyIfHm+/ISGM06vvhLn9zogvmBX+9htthtdv5ojmsl1k/P30OMMi4xbnoYsMrw6Py4X+xKzwt99adx56w98sEh5+u8hl+NBb/sN/NxfiNtEXzAp/+820sTf87SKnsS85N4uMT/Xf/xy6yfUdcNIl/M2n0/+CD3lzox1d/kqwyBD+JDj0vONvXkCiD1m+tIY+wxaLyC+tfpx2fI2/esv44R/vgl9YbxcZn2H/Fvqis13kzjfTfoxNdi3C1/ErhfArhfArhfArhfArhfArZW3hPz55dPnbi3uXj38cHFz+18XDl3cMbD50PbZfrC388PGXp2PKry//ePHT0/ffvhwufvzqpTyw+dD12J6xuvDD++/eXvz97fWfxsof//Wfhy/lgc2HNmMRq/ZkfeGH3+79e5Px8rZ+8eiLp/pyYPOh7dh+scLw29fvO8PfDBB+v9hW3D6HX4d/cXDw9ecDmw/xVL8vbLtu37X9+Y7/LDxv7vaFF9uv4aQv5z4b4Ms52DcIv1IIv1IIv1IIv1IIv1IIv1L+D4xEPzwksv59AAAAAElFTkSuQmCC" alt="Posterior on &quot;Probability $Y$ is increasing in $X$&quot;." width="60%" />
<p class="caption">Posterior on "Probability $Y$ is increasing in $X$".</p>
</div>
<p>Querying using query syntax</p>
<pre><code class="language-r">queries &lt;-
  make_model(&quot;X -&gt; Y&quot;) |&gt;
  query_distribution(
    query = list(increasing = &quot;(Y[X=1] &gt; Y[X=0])&quot;, 
                 ATE = &quot;(Y[X=1] - Y[X=0])&quot;),
    using = &quot;priors&quot;
  )
</code></pre>
<pre><code class="language-r">lipids_model |&gt;
  query_model(query = &quot;Y[X=1] - Y[X=0] :|: X==1 &amp; Y==1 &amp; Z==1&quot;, 
              using = &quot;posteriors&quot;) |&gt;
  plot()
</code></pre>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfgAAAH4CAMAAACR9g9NAAABYlBMVEUAAAAAADoAAGYAOmYAOpAAZmYAZrYZGT8ZGWIZP4EZYp8aGhozMzM6AAA6ADo6AGY6Ojo6OpA6ZmY6ZrY6kNs/GRk/GWI/Pz8/gb1NTU1NTW5NTY5NbqtNjshiGRliGT9iGWJiYmJin9lmAABmADpmAGZmOjpmOmZmOpBmZgBmtv9uTU1uTY5ubm5ubqtujshuq+SBPxmBvdmOTU2OTW6OTY6Obo6ObquOjm6Ojo6OjsiOq+SOyOSOyP+QOgCQOjqQkDqQ2/+fYhmfYj+fYmKfn2Kf2dmrbk2rbm6rbo6r5P+2ZgC2Zjq2tma2/7a2//+9gT+9vdm92dnIjk3Ijm7Ijo7Iq27IyI7IyP/I/+TI///Zn2LZn5/ZvYHZvb3Z2Z/Z2b3Z2dnbkDrb25Db2//b///kq27kq47k/8jk///r6+v4dm3/tmb/yI7/25D/29v/5Kv//7b//8j//9v//+T///9kEUdjAAAACXBIWXMAAAsSAAALEgHS3X78AAANpUlEQVR4nO3ai19b9RnH8WPt0BXrlU1S211aL1s3NbZTd0NHt7UT3Oik7kLntLjiagMDSv7//c7vJCTwBPo8T55DQs/n81Jy+zaNvHuSEFt0qZEVk34ANJmAb2jANzTgG9r0wD9Hohq/3VMEf48OBXxDA76hAd/QgG9owDc04GP74nuzs5dH3nJ3Pn+dnX3m2qgbTjrgQ/vyRzfvffnDa6Nuyr5ffP9m/nfyAR9a7+hNx/0z19L525e//MHsszf7F++lK/KX/k3f/ezuq8/+cT6fy8uTepzAB3e7epr/92d93XTFV3/tX7x37/flk8Hd+f5N6dy59CWfy8uTepzAB5d1/3Xzq/fSK33/sH7mWv9i7w/G3eqmG7Ozs+fSubvz+VxentTjBD648vX9q/cupwP7Rql7IzvP9y/m1/jb5/5wM99U/SGYrw723Em+zQM+tupdfXrv/uPylfvVy7dn0yt3vliplrfno/vV8slgdj7D53N5eWKPE/imBnxDA76hAd/QgG9oDYEnUY3f7imCP/KWbzW//GRHJ/O7Aa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuaB//wwC2Ngh/+TwdeEfC2gHeNgI8L+Bzwg4CvIeBdI+DjAj4H/CDgawh41wj4uIDPAT8I+BoC3jUCPi7gc8APAr6GgHeNgI8L+Bzwg4CvIeBdI+DjAj4H/CDgawh41wj4uIDPAT8I+BoC3jUCPi7gc2r4rZfua+7/qIB3jaYAfsyAd40mBJ+O8kcfLz76qCjm0vmvX75SzHS7neLM765qfqsDAe8aTRS+M9PdeWMlwb+wkk53Xl/cuQL8CY0mCr91vjzQE3x1Kb3WLwN/QqPJwacDPJ2eL64CP4nRpOBfWNl6fnE9He/Lc334CT3V791qp6+r7c1We2Ohu3mpd3U6v9FaOHa0d6t1aXgEfO74d/XLxdNvLqavxdn7ffjyzd1PJ3DE7/1pqaTcbHf3PvnnJ2vVlaul58bCsaN0YXVhaAR8zvPjXMlvbfyn+u13/vvhg5Kxu/l2eZy3Wu3df2wchB81+mapvAz8octm+J0r5Q935gJe4zcvLOXjt7v7/lr/usPwI0Z3gB81OkUf4OymYzmbbvyqXR3MQ/CrrYsPRo844keOTiH89rvlUVwljng5mtLX+IcPgVfWMy3fwG2/86C67ij4oVF+Vz918A9TJ/e7jRidIvhc+Sx+qAPwjxk9l/p20MMGN/RtOBXwrcOoQz+iq0bTccTzVD/i6MzH5/5nNP0r8rj1Wvlevf9BzdGLdJoadRfTAs+bu1ENfUaTW+0dsHeWKr7eBzXHLFK7v1gaMQC+apLwu9cv/HJhs53ej+19srZ7Pf1Alo7T3gHb//hl6IOa1MZve38eqg9qjlukp4WRdwF81SThNxYSTnqqv7OUfvgqn93b6SiufIY+o+lNq5ML/YN488JS9/jFanvkAPiqScKnH7Q3SvjN8n+prJavyfuftOx//DL0QU362t5+52+VX/6x7bjFRvlKIAfA99LAP+4nzv/t/228zpEf5o4+4rurJfzuBx+sVS59+OHPaPrT8mv6Q1J9QFfBH7M4+A5gMAC+lwK+/KHvuLvc+Ynir2GOfo1vvV3Cd1cv5Qutdg/+wGc0ud4LwPXWa3+vRI+A7y/2bpXv6i/KuwC+12PgD/zI37+y8/L5MyuPPirO3t+5UpxZWS9m0unZ+50Xz/x5Ll+dzv2lvGXojo484jUPOjTgc56n+k6inVuf667PrV/tPvpPOuLTaWeuM9PtXZ3O5VuGfs0RR/zFByOurzfgc543d+mVfOuVTxfTl3SkP7WY4JeLophJV3fm8tXpXL5l6NfwV69coymD3z+0ywtz1RGf/zz0j/j8Hu/AOz3gXaMpg3+x6L3Grxf53Ez+2xkZvnqNT/rF41/jJxPwOedTvTngXSPg4wI+N53/k6bOgM8BPwj4GgLeNQI+LuBzwA8CvoaAd42Ajwv4HPCDgK8h4F0j4OMCPgf8IOBrCHjXCPi4gM8BPwj4GgLeNQI+LuBzwA8CvoaAd42Ajwv4HPCDgK8h4F0j4OM6+r+yUfDDAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8LeBdI+DjAl4EvCLgbQHvGgEfF/Ai4BUBbwt41wj4uIAXAa8IeFvAu0bAxwW8CHhFwNsC3jUCPi7gRcArAt4W8K4R8HEBLwJeEfC2gHeNgI8LeBHwioC3BbxrBHxcwIuAVwS8rSmCJ1GN3+7pgR+zuG9S2D3V6TZ2wNd3T8DT9AV8QwO+oQHf0E47/N6t1qXydPd667W1dOHC0rj3lO+kf2GcO9potVrtsR5SnZ12+M12d3UhnW4sdDfau78OuKd8J/0L49xR6vO1sR5SnZ12+G+Wym90bnNh+2etiw/Gvad8J0N3O8ZDSidjPaQ6O+3wd/a/y7sfPii/0b8Z957yndwZA37waz9f6471kOrstMPvH16776+VJ26uA88d7ZAjfvvd7ngPqc5OO3z/BXX752v5hX7T+8o8/G5hcyHkNb4UH+sh1dlph89vodOz/GrvLbT7vfj+PeXTsd/Vpzsq0ce6o1o77fDkDPiGBnxDA76hAd/QgG9owB9u66X7k34IJxHwhwO+Qa3P5X/Xi2ImwX/90v1HHy92O+WlJzbgy7Yydfq688ZKH7488pevTvqR1RbwuU8Xt15J/ueLpxb78OmAL4q5ST+w2gI+15lJB3fnzMrO6xV8Ou08wc/zXeB77bz11krS73byEf/Cytbzi+mfRx/xVP+kt5yO750rxXeuXE2v7cvF02/y5o6eyIBvaMA3NOAbGvANDfiGBnxD+z+X43X7DoU11gAAAABJRU5ErkJggg==" alt="plot of chunk case-level-query" /></p>
<pre><code class="language-r">make_model(&quot;X -&gt; M -&gt; Y&quot;) |&gt;
  update_model(data.frame(X = rep(0:1, 8), Y = rep(0:1, 8)), iter = 4000) |&gt;
  query_model(
    &quot;Y[X=1] &gt; Y[X=0] :|: X==1 &amp; Y==1 &amp; M==1&quot;,
    using = &quot;posteriors&quot;,
    case_level = c(TRUE, FALSE)
  ) |&gt;
  plot()
</code></pre>
<p><img src="data:image/png;base64,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" alt="plot of chunk new-case-level-query" /></p>
<pre><code class="language-r">models &lt;- list(
  Unrestricted = lipids_model |&gt;
    update_model(data = lipids_data, refresh = 0),
  Restricted = lipids_model |&gt; set_restrictions(&quot;X[Z=1] &lt; X[Z=0]&quot;) |&gt;
    update_model(data = lipids_data, refresh = 0)
)
</code></pre>
<pre><code class="language-r">queries &lt;-
  query_model(
    models,
    query = list(ATE = &quot;Y[X=1] - Y[X=0]&quot;, POS = &quot;Y[X=1] &gt; Y[X=0] :|: Y==1 &amp; X==1&quot;),
    case_level = c(FALSE, TRUE),
    using = c(&quot;priors&quot;, &quot;posteriors&quot;),
    expand_grid = TRUE
  )
</code></pre>
<pre><code class="language-r">queries |&gt;
  dplyr::select(-starts_with(&quot;cred&quot;)) |&gt;
  knitr::kable(
    digits = 2,
    booktabs = TRUE,
    align = &quot;c&quot;,
    escape = TRUE,
    longtable = TRUE,
    linesep = &quot;&quot;
  ) |&gt;
  kableExtra::kable_classic_2(latex_options = c(&quot;hold_position&quot;))
</code></pre>
<table class=" lightable-classic-2" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:center;"> label </th>
   <th style="text-align:center;"> model </th>
   <th style="text-align:center;"> query </th>
   <th style="text-align:center;"> given </th>
   <th style="text-align:center;"> using </th>
   <th style="text-align:center;"> case_level </th>
   <th style="text-align:center;"> mean </th>
   <th style="text-align:center;"> sd </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> 0.20 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> 0.23 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.55 </td>
   <td style="text-align:center;"> 0.10 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.56 </td>
   <td style="text-align:center;"> 0.10 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.50 </td>
   <td style="text-align:center;"> 0.22 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.49 </td>
   <td style="text-align:center;"> 0.24 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.95 </td>
   <td style="text-align:center;"> 0.04 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> FALSE </td>
   <td style="text-align:center;"> 0.95 </td>
   <td style="text-align:center;"> 0.04 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.00 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.55 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> ATE </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] - Y[X=0] </td>
   <td style="text-align:center;"> - </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.56 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.50 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> priors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.49 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Unrestricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.95 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:center;"> POS </td>
   <td style="text-align:center;"> Restricted </td>
   <td style="text-align:center;"> Y[X=1] &gt; Y[X=0] </td>
   <td style="text-align:center;"> Y==1 &amp; X==1 </td>
   <td style="text-align:center;"> posteriors </td>
   <td style="text-align:center;"> TRUE </td>
   <td style="text-align:center;"> 0.95 </td>
   <td style="text-align:center;"> NA </td>
  </tr>
</tbody>
</table>
<pre><code class="language-r">queries |&gt; plot()
</code></pre>
<p><img src="data:image/png;base64,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" alt="Default plotting for a a set of queries over multiple models." /></p>
<h1 id="supplementary-material">Supplementary material</h1>
<h2 id="parallelization">Parallelization</h2>
<pre><code class="language-r">library(parallel)

options(mc.cores = parallel::detectCores())
</code></pre>
<pre><code class="language-r">library(future)
library(future.apply)

chains &lt;- 3
cores &lt;- 8

future::plan(list(
  future::tweak(future::multisession, workers = floor(cores / (chains + 1))),
  future::tweak(future::multisession, workers = chains)
))

model &lt;- make_model(&quot;X -&gt; Y&quot;)
data &lt;- list(data_1 = data.frame(X = 0:1, Y = 0:1),
             data_2 = data.frame(X = 0:1, Y = 1:0))

results &lt;-
  future.apply::future_lapply(data, function(d) {
    update_model(
      model = model,
      data = d,
      chains = chains,
      refresh = 0
    )
  }, future.seed = TRUE)
</code></pre>
<p>sample output</p>
<pre><code class="language-r">results$data_1 |&gt; inspect(what = &quot;stan_summary&quot;)
</code></pre>
<pre><code>## 
## stan_summary
## Stan model summary:
## 
## Inference for Stan model: simplexes.
## 3 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=3000.
## 
##             mean se_mean   sd   2.5%    25%   50%   75% 97.5% n_eff Rhat
## X.0         0.50    0.01 0.23   0.09   0.33  0.51  0.68  0.91  2009    1
## X.1         0.50    0.01 0.23   0.09   0.32  0.49  0.67  0.91  2009    1
## Y.00        0.23    0.00 0.18   0.01   0.08  0.19  0.34  0.65  1353    1
## Y.10        0.17    0.00 0.14   0.00   0.06  0.14  0.24  0.52  3302    1
## Y.01        0.37    0.00 0.21   0.02   0.20  0.36  0.53  0.80  2685    1
## Y.11        0.23    0.00 0.17   0.01   0.09  0.19  0.33  0.64  3557    1
## X0.Y00      0.12    0.00 0.11   0.00   0.03  0.08  0.17  0.42  1694    1
## X1.Y00      0.11    0.00 0.11   0.00   0.03  0.08  0.16  0.41  1561    1
## X0.Y10      0.08    0.00 0.08   0.00   0.02  0.06  0.12  0.31  2538    1
## X1.Y10      0.08    0.00 0.08   0.00   0.02  0.06  0.12  0.30  2894    1
## X0.Y01      0.19    0.00 0.14   0.01   0.07  0.16  0.27  0.53  2249    1
## X1.Y01      0.19    0.00 0.15   0.01   0.07  0.15  0.27  0.55  2689    1
## X0.Y11      0.12    0.00 0.11   0.00   0.03  0.08  0.16  0.40  2832    1
## X1.Y11      0.11    0.00 0.11   0.00   0.03  0.08  0.16  0.41  2962    1
## lp__       -9.36    0.05 1.63 -13.38 -10.22 -9.01 -8.14 -7.29  1110    1
## 
## Samples were drawn using NUTS(diag_e) at Fri Dec 20 11:33:12 2024.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).
</code></pre>
<h2 id="stan-code">Stan code</h2>
<pre><code class="language-r">CausalQueries:::stanmodels$simplexes
</code></pre>
<pre><code>S4 class stanmodel 'simplexes' coded as follows:
functions{
  row_vector col_sums(matrix X) {
    row_vector[cols(X)] s ;
    s = rep_row_vector(1, rows(X)) * X ;
    return s ;
  }
}
data {
int&lt;lower=1&gt; n_params;
int&lt;lower=1&gt; n_paths;
int&lt;lower=1&gt; n_types;
int&lt;lower=1&gt; n_param_sets;
int&lt;lower=1&gt; n_nodes;
array[n_param_sets] int&lt;lower=1&gt; n_param_each;
int&lt;lower=1&gt; n_data;
int&lt;lower=1&gt; n_events;
int&lt;lower=1&gt; n_strategies;
int&lt;lower=0, upper=1&gt; keep_type_distribution;
vector&lt;lower=0&gt;[n_params] lambdas_prior;
array[n_param_sets] int&lt;lower=1&gt; l_starts;
array[n_param_sets] int&lt;lower=1&gt; l_ends;
array[n_nodes] int&lt;lower=1&gt; node_starts;
array[n_nodes] int&lt;lower=1&gt; node_ends;
array[n_strategies] int&lt;lower=1&gt; strategy_starts;
array[n_strategies] int&lt;lower=1&gt; strategy_ends;
matrix[n_params, n_types] P;
matrix[n_params, n_paths] parmap;
matrix[n_paths, n_data] map;
matrix&lt;lower=0,upper=1&gt;[n_events,n_data] E;
array[n_events] int&lt;lower=0&gt; Y;
}
parameters {
vector&lt;lower=0&gt;[n_params - n_param_sets] gamma;
}
transformed parameters {
vector&lt;lower=0, upper=1&gt;[n_params] lambdas;
vector&lt;lower=1&gt;[n_param_sets] sum_gammas;
matrix[n_params, n_paths] parlam;
matrix[n_nodes, n_paths] parlam2;
vector&lt;lower=0, upper=1&gt;[n_paths] w_0;
vector&lt;lower=0, upper=1&gt;[n_data] w;
vector&lt;lower=0, upper=1&gt;[n_events] w_full;
// Cases in which a parameter set has only one value need special handling
// they have no gamma components and sum_gamma needs to be made manually
for (i in 1:n_param_sets) {
  if (l_starts[i] &gt;= l_ends[i]) {
    sum_gammas[i] = 1;
    lambdas[l_starts[i]] = 1;
    }
  else if (l_starts[i] &lt; l_ends[i]) {
    sum_gammas[i] =
    1 + sum(gamma[(l_starts[i] - (i-1)):(l_ends[i] - i)]);
    lambdas[l_starts[i]:l_ends[i]] =
    append_row(1, gamma[(l_starts[i] - (i-1)):(l_ends[i] - i)]) /
      sum_gammas[i];
    }
  }
// Mapping from parameters to data types
// (usual case): [n_par * n_data] * [n_par * n_data]
parlam  = rep_matrix(lambdas, n_paths) .* parmap;
// Sum probability over nodes on each path
for (i in 1:n_nodes) {
 parlam2[i,] = col_sums(parlam[(node_starts[i]):(node_ends[i]),]);
 }
// then take product  to get probability of data type on path
for (i in 1:n_paths) {
  w_0[i] = prod(parlam2[,i]);
 }
 // last (if confounding): map to n_data columns instead of n_paths
 w = map'*w_0;
  // Extend/reduce to cover all observed data types
 w_full = E * w;
}
model {
// Dirichlet distributions
for (i in 1:n_param_sets) {
  target += dirichlet_lpdf(lambdas[l_starts[i]:l_ends[i]]  |
    lambdas_prior[l_starts[i] :l_ends[i]]);
  target += -n_param_each[i] * log(sum_gammas[i]);
 }
// Multinomials
// Note with censoring event_probabilities might not sum to 1
for (i in 1:n_strategies) {
  target += multinomial_lpmf(
  Y[strategy_starts[i]:strategy_ends[i]] |
    w_full[strategy_starts[i]:strategy_ends[i]]/
     sum(w_full[strategy_starts[i]:strategy_ends[i]]));
 }
}
// Option to export distribution of causal types
generated quantities{
vector[n_types] types;
if (keep_type_distribution == 1){
for (i in 1:n_types) {
   types[i] = prod(P[, i].*lambdas + 1 - P[,i]);
}}
 if (keep_type_distribution == 0){
    types = rep_vector(1, n_types);
 }
} 
</code></pre>
<h2 id="performance">Performance</h2>
<p>effect of model complexity on run-time</p>
<pre><code class="language-r">model &lt;- list(
  CausalQueries::make_model(&quot;X -&gt; Y&quot;),
  CausalQueries::make_model(&quot;X1 -&gt; Y &lt;- X2&quot;),
  CausalQueries::make_model(&quot;X1 -&gt; Y; X2 -&gt; Y; X3 -&gt; Y&quot;)
)

iter &lt;- 5000

data &lt;- expand_grid(
  X1 = 0:1,
  X2 = 0:1,
  X3 = 0:1,
  X4 = 0:1
) |&gt;
  uncount(20) |&gt;
  mutate(Y = 1 * (X1 + X2 - X3 + X1 * X4 + rnorm(n()) &gt; 0))

options(mc.cores = parallel::detectCores())
</code></pre>
<pre><code class="language-r">benchmark_model &lt;- microbenchmark::microbenchmark(
  m1 = CausalQueries::update_model(model[[1]], data, iter = iter),
  m2 = CausalQueries::update_model(model[[2]], data, iter = iter),
  m3 = CausalQueries::update_model(model[[3]], data, iter = iter),
  times = 5
)

kable(summary(benchmark_model), digits = 2)
</code></pre>
<table>
<thead>
<tr>
<th align="left">expr</th>
<th align="right">min</th>
<th align="right">lq</th>
<th align="right">mean</th>
<th align="right">median</th>
<th align="right">uq</th>
<th align="right">max</th>
<th align="right">neval</th>
<th align="left">cld</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">m1</td>
<td align="right">6.65</td>
<td align="right">6.73</td>
<td align="right">7.65</td>
<td align="right">6.88</td>
<td align="right">7.53</td>
<td align="right">10.44</td>
<td align="right">5</td>
<td align="left">a</td>
</tr>
<tr>
<td align="left">m2</td>
<td align="right">9.41</td>
<td align="right">9.42</td>
<td align="right">9.57</td>
<td align="right">9.62</td>
<td align="right">9.62</td>
<td align="right">9.76</td>
<td align="right">5</td>
<td align="left">a</td>
</tr>
<tr>
<td align="left">m3</td>
<td align="right">95.10</td>
<td align="right">95.40</td>
<td align="right">96.42</td>
<td align="right">95.73</td>
<td align="right">96.09</td>
<td align="right">99.77</td>
<td align="right">5</td>
<td align="left">b</td>
</tr>
</tbody>
</table>
<p>effect of data size on run-time</p>
<pre><code class="language-r">model &lt;- CausalQueries::make_model(&quot;X -&gt; Y&quot;)

data &lt;- lapply(10 ^ c(1:5), function(n) {
  CausalQueries::make_data(model, n)
})
</code></pre>
<pre><code class="language-r">benchmark_data &lt;- microbenchmark::microbenchmark(
  d0 = CausalQueries::update_model(model, data[[1]], iter = iter),
  d1 = CausalQueries::update_model(model, data[[2]], iter = iter),
  d2 = CausalQueries::update_model(model, data[[3]], iter = iter),
  d3 = CausalQueries::update_model(model, data[[4]], iter = iter),
  d4 = CausalQueries::update_model(model, data[[5]], iter = iter),
  times = 5
)

kable(summary(benchmark_data), digits = 2)
</code></pre>
<table>
<thead>
<tr>
<th align="left">expr</th>
<th align="right">min</th>
<th align="right">lq</th>
<th align="right">mean</th>
<th align="right">median</th>
<th align="right">uq</th>
<th align="right">max</th>
<th align="right">neval</th>
<th align="left">cld</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">d0</td>
<td align="right">6.77</td>
<td align="right">7.22</td>
<td align="right">7.47</td>
<td align="right">7.30</td>
<td align="right">7.96</td>
<td align="right">8.12</td>
<td align="right">5</td>
<td align="left">a</td>
</tr>
<tr>
<td align="left">d1</td>
<td align="right">7.51</td>
<td align="right">7.70</td>
<td align="right">8.05</td>
<td align="right">7.83</td>
<td align="right">8.34</td>
<td align="right">8.87</td>
<td align="right">5</td>
<td align="left">a</td>
</tr>
<tr>
<td align="left">d2</td>
<td align="right">9.44</td>
<td align="right">9.62</td>
<td align="right">9.83</td>
<td align="right">9.82</td>
<td align="right">10.06</td>
<td align="right">10.20</td>
<td align="right">5</td>
<td align="left">a</td>
</tr>
<tr>
<td align="left">d3</td>
<td align="right">15.76</td>
<td align="right">16.04</td>
<td align="right">16.23</td>
<td align="right">16.14</td>
<td align="right">16.43</td>
<td align="right">16.81</td>
<td align="right">5</td>
<td align="left">b</td>
</tr>
<tr>
<td align="left">d4</td>
<td align="right">33.06</td>
<td align="right">33.26</td>
<td align="right">36.36</td>
<td align="right">34.25</td>
<td align="right">38.79</td>
<td align="right">42.46</td>
<td align="right">5</td>
<td align="left">c</td>
</tr>
</tbody>
</table>
</div>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>
</body>
</html>
